# 课程管理功能 - 快速使用指南

## 🚀 快速开始

### 1️⃣ 启动后端服务

```bash
cd D:\健身房预约小程序\springboot
mvn spring-boot:run
```

### 2️⃣ 获取访问令牌

使用管理员账号登录：

**请求:**
```bash
POST http://localhost:9090/user/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin"
}
```

**响应:** 复制返回的 token，后续请求都需要使用

---

## 📝 常用操作示例

### ✨ 创建课程

**最简示例（只填必填字段）:**

```json
POST http://localhost:9090/course
Authorization: Bearer {your_token}

{
  "id": "course-uuid-001",
  "name": "减脂训练营",
  "duration": 60,
  "maxParticipants": 20,
  "price": 88.00,
  "status": 1
}
```

**完整示例（包含分类和教练）:**

```json
POST http://localhost:9090/course
Authorization: Bearer {your_token}

{
  "id": "course-uuid-002",
  "name": "专业瑜伽课",
  "categoryId": 1,
  "coachId": 4,
  "description": "由专业教练指导的瑜伽课程",
  "coverImage": "/images/yoga.jpg",
  "duration": 90,
  "maxParticipants": 15,
  "price": 128.00,
  "status": 1
}
```

---

### 🔍 查询课程

**分页查询所有课程:**

```
GET http://localhost:9090/course/page?current=1&size=10
Authorization: Bearer {your_token}
```

**按名称搜索:**

```
GET http://localhost:9090/course/page?name=瑜伽
Authorization: Bearer {your_token}
```

**只查询上架的课程:**

```
GET http://localhost:9090/course/page?status=1
Authorization: Bearer {your_token}
```

**查询课程详情:**

```
GET http://localhost:9090/course/course-uuid-001
Authorization: Bearer {your_token}
```

---

### ✏️ 更新课程

```json
PUT http://localhost:9090/course/course-uuid-001
Authorization: Bearer {your_token}

{
  "name": "高级减脂训练营",
  "categoryId": 2,
  "coachId": 5,
  "description": "更新后的课程描述",
  "duration": 75,
  "maxParticipants": 25,
  "price": 118.00,
  "status": 1
}
```

---

### 🔄 上架/下架课程

**下架课程:**

```
PUT http://localhost:9090/course/course-uuid-001/status?status=0
Authorization: Bearer {your_token}
```

**上架课程:**

```
PUT http://localhost:9090/course/course-uuid-001/status?status=1
Authorization: Bearer {your_token}
```

---

### 🗑️ 删除课程

```
DELETE http://localhost:9090/course/course-uuid-001
Authorization: Bearer {your_token}
```

---

## 📊 可用的分类和教练

### 课程分类 (gym_course_category)

| ID | 分类名称 | 说明 |
|----|---------|------|
| 1  | 瑜伽课程 | 各类瑜伽课程 |
| 2  | 力量训练 | 器械和力量训练课程 |
| 3  | 有氧运动 | 有氧健身课程 |
| 4  | 普拉提 | 普拉提塑形课程 |
| 5  | 动感单车 | 动感单车课程 |
| 6  | 拉伸放松 | 拉伸恢复课程 |

### 可用教练 (user表 where user_type='COACH')

| ID | 姓名 | 专长 |
|----|------|------|
| 4  | 李教练 | 瑜伽、普拉提、柔韧性训练 |
| 5  | 王教练 | 力量训练、健美、运动表现 |
| 6  | 张教练 | 有氧健身、动感单车、团课 |

---

## ⚠️ 常见问题

### Q1: 创建课程失败，提示"课程名称已存在"

**原因:** 系统中已经有同名课程了  
**解决:** 更换课程名称或查询现有课程

### Q2: 创建课程失败，提示"课程分类不存在"

**原因:** 指定的 categoryId 在数据库中不存在  
**解决:** 
- 不指定 categoryId（设为 null）
- 或者先创建课程分类
- 或者使用上面列表中的分类ID

### Q3: 创建课程失败，提示"教练不存在"或"指定用户不是教练"

**原因:** coachId 不存在或该用户不是教练角色  
**解决:**
- 不指定 coachId（设为 null）
- 或者使用上面列表中的教练ID
- 或者先创建教练账号

### Q4: 查询结果中 categoryName 或 coachName 为 null

**原因:** 
- 课程没有设置分类或教练（正常情况）
- 或者关联的分类/教练已被删除

**解决:** 这是正常现象，课程的分类和教练都是可选的

### Q5: 如何生成课程ID？

**方法1 - 使用UUID（推荐）:**
```javascript
// JavaScript
const uuid = crypto.randomUUID()
```

**方法2 - 自定义格式:**
```
course-2025-001
yoga-basic-001
```

⚠️ 注意：ID最长36个字符，建议使用UUID格式

---

## 🎯 使用技巧

### 1. 批量操作

如果需要批量创建课程，可以循环调用创建接口，但要注意：
- 每个课程的ID必须唯一
- 课程名称不能重复
- 控制请求频率，避免服务器压力

### 2. 数据关联

创建课程时建议：
1. 先查询可用的课程分类列表
2. 先查询可用的教练列表
3. 再创建课程，选择合适的分类和教练

### 3. 状态管理

- 新建课程时，如果还在准备阶段，可以设置 `status: 0`（下架状态）
- 课程准备好后，再调用更新状态接口上架
- 临时不可用的课程可以下架，不需要删除

### 4. 性能优化

系统已做批量关联查询优化：
- 分页查询课程时，会自动批量加载分类和教练信息
- 无需担心N+1查询问题

---

## 📱 Swagger API文档

启动后端服务后，可以访问在线API文档：

```
http://localhost:9090/doc.html
```

在文档中可以：
- ✅ 查看所有接口的详细说明
- ✅ 在线测试API
- ✅ 查看请求/响应示例
- ✅ 下载API文档

---

## 🔗 相关文档

- [API测试文档-课程管理.md](./API测试文档-课程管理.md) - 完整的API测试文档
- [5分钟快速启动.md](../5分钟快速启动.md) - 项目整体启动指南

---

## 📞 技术支持

如遇问题，请检查：
1. ✅ 后端服务是否正常启动（端口9090）
2. ✅ Token是否有效（未过期）
3. ✅ 请求参数是否符合规范
4. ✅ 分类ID和教练ID是否存在

查看后端日志获取详细错误信息。
