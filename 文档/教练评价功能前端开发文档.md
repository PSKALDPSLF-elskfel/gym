# 教练评价功能 - 前端开发文档

## 📋 文档信息
- **项目名称**: 教练端评价管理系统
- **开发日期**: 2025-12-12
- **技术栈**: Vue3 + Ant Design Vue + Vite
- **文档版本**: v1.0

---

## 📚 目录
1. [功能概述](#功能概述)
2. [页面结构](#页面结构)
3. [API接口](#api接口)
4. [组件说明](#组件说明)
5. [使用指南](#使用指南)

---

## 功能概述

### ✨ 已实现功能

#### 1. 评价列表页面 (List.vue)
- ✅ **统计卡片展示**
  - 总评价数
  - 平均评分
  - 五星好评数
  - 回复率

- ✅ **评价列表**
  - 分页加载
  - 按评分筛选
  - 显示用户头像、昵称
  - 星级评分展示
  - 评价标签展示
  - 评价内容展示
  - 评价图片预览
  - 教练回复展示

- ✅ **互动功能**
  - 回复评价（未回复的评价）
  - 查看评价详情
  - 点赞数量显示

#### 2. 评价统计页面 (Reply.vue)
- ✅ **核心统计指标**
  - 总评价数（渐变卡片）
  - 平均评分（渐变卡片）
  - 回复率（渐变卡片）
  - 五星好评数（渐变卡片）

- ✅ **星级分布**
  - 进度条展示各星级占比
  - 显示每个星级的数量

- ✅ **最新评价**
  - 显示最近5条评价
  - 快速回复功能
  - 跳转到评价列表

---

## 页面结构

### 文件组织
```
src/
├── api/
│   └── review.js              # 评价相关API接口
├── views/
│   └── reviews/
│       ├── List.vue           # 评价列表页面
│       └── Reply.vue          # 评价统计页面
└── router/
    └── index.js               # 路由配置
```

### 路由结构
```javascript
{
  path: 'reviews',
  name: 'Reviews',
  redirect: '/reviews/list',
  meta: { title: '学员评价', icon: 'StarOutlined' },
  children: [
    {
      path: 'list',
      name: 'ReviewsList',
      component: () => import('@/views/reviews/List.vue'),
      meta: { title: '评价列表' }
    },
    {
      path: 'statistics',
      name: 'ReviewsStatistics',
      component: () => import('@/views/reviews/Reply.vue'),
      meta: { title: '评价统计' }
    }
  ]
}
```

---

## API接口

### 接口文件: `src/api/review.js`

#### 1. 获取我收到的评价列表
```javascript
export const getReceivedReviews = (params) => {
  return request.get('/coach/reviews/received', { params })
}
```

**参数**:
- `pageNum`: 页码（默认1）
- `pageSize`: 每页数量（默认10）

**返回**:
```json
{
  "code": 200,
  "data": {
    "records": [...],
    "total": 100,
    "current": 1,
    "size": 10
  }
}
```

#### 2. 获取评价详情
```javascript
export const getReviewDetail = (reviewId) => {
  return request.get(`/coach/reviews/${reviewId}`)
}
```

#### 3. 回复评价
```javascript
export const replyReview = (reviewId, data) => {
  return request.post(`/coach/reviews/${reviewId}/reply`, data)
}
```

**参数**:
```json
{
  "reply": "感谢您的认可！"
}
```

#### 4. 获取我的评价统计
```javascript
export const getMyStatistics = () => {
  return request.get('/coach/reviews/statistics')
}
```

**返回**:
```json
{
  "code": 200,
  "data": {
    "totalReviews": 100,
    "averageRating": 4.85,
    "rating5Count": 85,
    "rating4Count": 12,
    "rating3Count": 2,
    "rating2Count": 1,
    "rating1Count": 0,
    "replyRate": 95.50
  }
}
```

#### 5. 获取评价标签列表
```javascript
export const getReviewTags = (tagType) => {
  return request.get('/reviews/tags', { params: { tagType } })
}
```

---

## 组件说明

### 1. 评价列表页面 (List.vue)

#### 核心状态
```javascript
// 统计数据
const statistics = reactive({
  totalReviews: 0,
  averageRating: 0,
  rating5Count: 0,
  replyRate: 0
})

// 评价列表
const reviews = ref([])
const loading = ref(false)
const filterRating = ref(undefined)

// 分页
const pagination = reactive({
  current: 1,
  pageSize: 10,
  total: 0
})
```

#### 核心方法
```javascript
// 加载统计数据
const loadStatistics = async () => {
  const res = await getMyStatistics()
  Object.assign(statistics, res.data)
}

// 加载评价列表
const loadReviews = async () => {
  const params = {
    pageNum: pagination.current,
    pageSize: pagination.pageSize,
    rating: filterRating.value
  }
  const res = await getReceivedReviews(params)
  reviews.value = res.data.records
  pagination.total = res.data.total
}

// 回复评价
const handleReplySubmit = async () => {
  await replyReview(currentReview.value.id, { reply: replyForm.reply })
  loadReviews()
  loadStatistics()
}
```

#### UI组件使用

**统计卡片**:
```vue
<a-statistic
  title="总评价数"
  :value="statistics.totalReviews"
  :value-style="{ color: '#3f8600' }"
>
  <template #prefix>
    <StarOutlined />
  </template>
</a-statistic>
```

**评价列表**:
```vue
<a-list
  :data-source="reviews"
  :pagination="pagination"
  @change="handlePageChange"
>
  <template #renderItem="{ item }">
    <!-- 评价项 -->
  </template>
</a-list>
```

**图片预览**:
```vue
<a-image-preview-group>
  <a-image
    v-for="(img, index) in item.images"
    :key="index"
    :src="img"
    :width="100"
  />
</a-image-preview-group>
```

---

### 2. 评价统计页面 (Reply.vue)

#### 核心功能

**渐变卡片**:
```vue
<a-card 
  :bordered="false" 
  style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
>
  <a-statistic
    title="总评价数"
    :value="statistics.totalReviews"
    :value-style="{ color: '#fff', fontSize: '32px' }"
  />
</a-card>
```

**星级分布进度条**:
```vue
<div class="rating-item" v-for="i in 5" :key="i">
  <div class="rating-label">
    <a-rate :value="6 - i" disabled />
  </div>
  <div class="rating-bar">
    <a-progress
      :percent="getRatingPercent(6 - i)"
      :stroke-color="getRatingColor(6 - i)"
    />
  </div>
  <div class="rating-count">
    {{ getRatingCount(6 - i) }}
  </div>
</div>
```

**计算方法**:
```javascript
// 获取星级数量
const getRatingCount = (rating) => {
  const key = `rating${rating}Count`
  return statistics[key] || 0
}

// 获取星级百分比
const getRatingPercent = (rating) => {
  if (statistics.totalReviews === 0) return 0
  return Math.round((getRatingCount(rating) / statistics.totalReviews) * 100)
}

// 获取星级颜色
const getRatingColor = (rating) => {
  const colors = {
    5: '#faad14',
    4: '#52c41a',
    3: '#1890ff',
    2: '#ff7a45',
    1: '#f5222d'
  }
  return colors[rating]
}
```

---

## 使用指南

### 快速开始

#### 1. 安装依赖
```bash
cd vue3/coach
npm install
```

#### 2. 启动开发服务器
```bash
npm run dev
```

#### 3. 访问页面
```
http://localhost:5173
```

---

### 页面访问路径

1. **评价列表**: `/reviews/list`
2. **评价统计**: `/reviews/statistics`

---

### 功能演示

#### 查看评价列表
1. 登录教练账号
2. 点击侧边栏"学员评价" → "评价列表"
3. 查看所有收到的评价
4. 可以按评分筛选

#### 回复评价
1. 在评价列表中找到未回复的评价
2. 点击"回复"按钮
3. 在弹窗中输入回复内容
4. 点击"确定"提交

#### 查看统计
1. 点击侧边栏"学员评价" → "评价统计"
2. 查看核心指标卡片
3. 查看星级分布
4. 查看最新评价

---

## 🎨 样式说明

### 主题色
```css
/* 主色 */
--primary-color: #1890ff;

/* 渐变色 */
--gradient-purple: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
--gradient-pink: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
--gradient-blue: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
--gradient-green: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
```

### 星级颜色
```javascript
5星: #faad14 (金色)
4星: #52c41a (绿色)
3星: #1890ff (蓝色)
2星: #ff7a45 (橙色)
1星: #f5222d (红色)
```

---

## 🔧 常见问题

### Q1: 评价列表加载失败？

**检查**:
1. 后端服务是否启动
2. API接口路径是否正确
3. 是否登录且有token
4. 浏览器控制台查看错误信息

**解决**:
```javascript
// 检查request.js中的baseURL配置
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000
})
```

---

### Q2: 图片无法显示？

**原因**: 图片URL路径问题

**解决**:
```javascript
// 确保图片URL是完整路径
const fullImageUrl = img.startsWith('http') 
  ? img 
  : `${import.meta.env.VITE_API_BASE_URL}${img}`
```

---

### Q3: 统计数据不更新？

**解决**:
```javascript
// 回复评价后手动刷新统计
const handleReplySubmit = async () => {
  await replyReview(currentReview.value.id, { reply: replyForm.reply })
  await loadStatistics() // 重新加载统计
  await loadReviews()    // 重新加载列表
}
```

---

## 📊 性能优化建议

### 1. 图片懒加载
```vue
<a-image
  :src="img"
  lazy
  :placeholder="true"
/>
```

### 2. 列表虚拟滚动
```vue
<!-- 数据量大时使用虚拟列表 -->
<a-virtual-list
  :data="reviews"
  :height="600"
  :item-height="100"
/>
```

### 3. 防抖处理
```javascript
import { debounce } from 'lodash-es'

// 搜索防抖
const handleSearch = debounce((value) => {
  filterRating.value = value
  loadReviews()
}, 300)
```

---

## 🚀 后续优化

### 短期优化
- [ ] 添加加载骨架屏
- [ ] 优化移动端适配
- [ ] 添加下拉刷新
- [ ] 添加评价导出功能

### 中期优化
- [ ] 使用ECharts展示评价趋势图
- [ ] 添加评价关键词云
- [ ] 实现评价搜索功能
- [ ] 添加批量回复功能

### 长期优化
- [ ] PWA支持
- [ ] 离线缓存
- [ ] 实时通知（WebSocket）
- [ ] 数据可视化大屏

---

## 📝 更新日志

### v1.0 (2025-12-12)
- ✅ 完成评价列表页面
- ✅ 完成评价统计页面
- ✅ 完成回复评价功能
- ✅ 完成API接口封装
- ✅ 完成路由配置

---

## 📞 技术支持

如遇问题请查看:
1. [后端API文档](../../springboot/API测试文档-教练评价.md)
2. [快速使用指南](../../springboot/教练评价功能-快速使用指南.md)
3. 浏览器开发者工具 (F12)
4. Vue Devtools

---

**开发完成！** 🎉
