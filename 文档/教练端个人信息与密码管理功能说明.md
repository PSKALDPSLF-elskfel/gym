# 教练端个人信息与密码管理功能

## 功能概述

本次更新为教练端添加了完善的个人信息编辑和密码修改功能。

## 功能列表

### 1. 个人信息编辑
- **路由路径**: `/profile`
- **访问方式**: 点击右上角用户名下拉菜单 → "个人信息"

#### 可编辑字段

**用户基本信息:**
- 昵称 (nickname)
- 手机号 (phone)
- 邮箱 (email)
- 头像URL (avatar)

**教练专业信息:**
- 专业领域 (specialty)
- 个人简介 (introduction)
- 资质证书 (certificate)

**只读字段:**
- 用户名 (username)
- 用户类型 (userType)

#### 字段验证规则
- 昵称: 最大50个字符
- 手机号: 必须符合中国大陆手机号格式 (1[3-9]\d{9})
- 邮箱: 必须符合邮箱格式，最大100个字符
- 头像URL: 最大255个字符

### 2. 修改密码
- **路由路径**: `/change-password`
- **访问方式**: 点击右上角用户名下拉菜单 → "修改密码"

#### 密码规则
- 旧密码: 必填，用于验证身份
- 新密码: 6-20个字符
- 确认新密码: 必须与新密码一致
- 新密码不能与旧密码相同

#### 修改密码后行为
- 密码修改成功后，系统会自动退出登录
- 需要使用新密码重新登录

## 后端API接口

### 1. 获取教练信息
```
GET /coaches/info
```
返回当前登录教练的完整信息（包括用户信息和教练信息）

### 2. 更新用户信息
```
PUT /user/{userId}
Content-Type: application/json

{
  "nickname": "张教练",
  "phone": "13800138000",
  "email": "coach@example.com",
  "avatar": "/images/avatar.jpg"
}
```

### 3. 更新教练信息
```
PUT /coaches/info
Content-Type: application/json

{
  "specialty": "力量训练、体能训练",
  "introduction": "10年健身教练经验，擅长力量训练...",
  "certificate": "国家级健身教练证书\nISSA认证私人教练"
}
```

### 4. 修改密码
```
PUT /user/password/{userId}
Content-Type: application/json

{
  "oldPassword": "old123456",
  "newPassword": "new123456"
}
```

## 前端文件结构

### 新增页面
```
vue3/coach/src/views/profile/
├── Profile.vue           # 个人信息编辑页面
└── ChangePassword.vue    # 修改密码页面
```

### 新增API文件
```
vue3/coach/src/api/
└── user.js              # 用户相关API
```

### 更新的文件
```
vue3/coach/src/
├── router/index.js                        # 添加了个人信息和修改密码路由
└── components/layout/NavHeader.vue        # 更新了下拉菜单的点击事件
```

## 使用说明

### 编辑个人信息
1. 登录教练端系统
2. 点击右上角用户名
3. 选择"个人信息"
4. 修改需要更新的字段
5. 点击"保存修改"按钮
6. 系统会同时更新用户基本信息和教练专业信息

### 修改密码
1. 登录教练端系统
2. 点击右上角用户名
3. 选择"修改密码"
4. 输入旧密码（用于验证身份）
5. 输入新密码（6-20个字符）
6. 再次输入新密码确认
7. 点击"确认修改"按钮
8. 密码修改成功后会自动退出，使用新密码重新登录

## 后端代码更新

### CoachResponseDTO
新增字段:
- `userType`: 用户类型
- `email`: 邮箱

### CoachService
更新方法:
- `entityToResponseDTO`: 添加了 userType 和 email 字段的映射

## 注意事项

1. **密码安全**: 
   - 后端使用BCrypt加密存储密码
   - 修改密码需要验证旧密码
   - 新密码必须与旧密码不同

2. **邮箱唯一性**:
   - 修改邮箱时会检查是否已被其他用户使用
   - 同一个邮箱不能被多个账号使用

3. **手机号格式**:
   - 仅支持中国大陆手机号格式
   - 格式: 1[3-9]\d{9}

4. **自动退出**:
   - 修改密码成功后会自动退出登录
   - 这是为了安全考虑，确保使用新密码重新验证身份

5. **表单验证**:
   - 所有字段都有客户端验证
   - 后端也会进行相同的验证
   - 确保数据的完整性和正确性

## 测试步骤

### 测试个人信息编辑
1. 登录教练端
2. 访问个人信息页面
3. 修改昵称、手机号等字段
4. 提交保存
5. 验证信息是否更新成功
6. 检查右上角显示的昵称是否更新

### 测试密码修改
1. 登录教练端
2. 访问修改密码页面
3. 测试旧密码错误的情况
4. 测试新密码格式不正确的情况
5. 测试两次新密码不一致的情况
6. 输入正确信息提交
7. 验证是否自动退出
8. 使用新密码重新登录

## 技术栈

- **前端**: Vue 3 + Ant Design Vue + Vite
- **后端**: Spring Boot + MyBatis Plus
- **密码加密**: BCrypt
- **认证**: JWT

## 相关文件

### 前端
- `vue3/coach/src/views/profile/Profile.vue`
- `vue3/coach/src/views/profile/ChangePassword.vue`
- `vue3/coach/src/api/user.js`
- `vue3/coach/src/api/coach.js`
- `vue3/coach/src/router/index.js`
- `vue3/coach/src/components/layout/NavHeader.vue`

### 后端
- `CoachController.java` - 获取和更新教练信息
- `UserController.java` - 更新用户信息和密码
- `CoachService.java` - 教练业务逻辑
- `UserService.java` - 用户业务逻辑
- `CoachResponseDTO.java` - 教练响应DTO
- `UserUpdateCommandDTO.java` - 用户更新命令DTO
- `UserPasswordUpdateCommandDTO.java` - 密码更新命令DTO

## 常见问题

**Q: 修改密码后为什么会自动退出？**
A: 这是安全措施，确保密码修改后使用新密码重新验证身份。

**Q: 可以不填写专业领域和个人简介吗？**
A: 可以，这些字段都是可选的。但建议填写完整，有助于学员了解教练。

**Q: 邮箱可以不填写吗？**
A: 邮箱是可选的，但建议填写，用于找回密码等功能。

**Q: 修改信息需要管理员审核吗？**
A: 不需要，教练可以直接修改自己的信息。

**Q: 头像如何上传？**
A: 当前版本需要手动输入头像URL。如果需要上传功能，可以集成文件上传服务。
