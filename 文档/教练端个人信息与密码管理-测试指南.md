# 教练端个人信息与密码管理功能 - 快速测试指南

## 测试前准备

### 1. 启动后端服务
```bash
cd D:\健身房预约小程序\springboot
mvn spring-boot:run
```
确保后端服务运行在: http://localhost:9090

### 2. 启动前端服务
```bash
cd D:\健身房预约小程序\vue3\coach
npm install  # 如果是第一次运行
npm run dev
```
前端服务运行在: http://localhost:5173

## 测试步骤

### 测试1: 登录系统
1. 访问 http://localhost:5173
2. 使用测试账号登录:
   - 用户名: `admin`
   - 密码: `123456`
3. 验证是否成功跳转到工作台页面

### 测试2: 访问个人信息页面
1. 点击右上角用户名下拉菜单
2. 选择"个人信息"
3. 验证页面是否正确显示以下内容:
   - ✓ 用户名（只读，灰色显示）
   - ✓ 用户类型（只读，灰色显示）
   - ✓ 昵称（可编辑）
   - ✓ 手机号（可编辑）
   - ✓ 邮箱（可编辑）
   - ✓ 头像URL（可编辑）
   - ✓ 专业领域（可编辑）
   - ✓ 个人简介（可编辑）
   - ✓ 资质证书（可编辑）

### 测试3: 编辑个人信息
#### 3.1 测试字段验证
1. **手机号格式验证**
   - 输入: `12345678901`（错误格式）
   - 点击提交
   - ✓ 应显示错误提示: "手机号格式不正确"
   
2. **邮箱格式验证**
   - 输入: `invalid-email`（错误格式）
   - 点击提交
   - ✓ 应显示错误提示: "邮箱格式不正确"

3. **昵称长度验证**
   - 输入超过50个字符的昵称
   - ✓ 应显示错误提示: "昵称长度不能超过50个字符"

#### 3.2 测试成功保存
1. 填写正确的数据:
   ```
   昵称: 张教练
   手机号: 13800138000
   邮箱: coach@example.com
   头像URL: /images/avatar.jpg
   专业领域: 力量训练、体能训练
   个人简介: 10年健身教练经验，擅长力量训练和体能提升
   资质证书: 国家级健身教练证书
   ```
2. 点击"保存修改"按钮
3. ✓ 应显示成功提示: "个人信息更新成功"
4. ✓ 右上角显示的名称应更新为新昵称

#### 3.3 测试取消按钮
1. 修改任意字段
2. 点击"取消"按钮
3. ✓ 表单应恢复到原始值

### 测试4: 访问修改密码页面
1. 点击右上角用户名下拉菜单
2. 选择"修改密码"
3. 验证页面是否正确显示:
   - ✓ 温馨提示信息框
   - ✓ 旧密码输入框
   - ✓ 新密码输入框
   - ✓ 确认新密码输入框
   - ✓ 确认修改和重置按钮

### 测试5: 修改密码
#### 5.1 测试旧密码错误
1. 输入:
   - 旧密码: `wrongpassword`
   - 新密码: `newpass123`
   - 确认新密码: `newpass123`
2. 点击"确认修改"
3. ✓ 应显示错误提示: "旧密码不正确"

#### 5.2 测试新密码长度不足
1. 输入:
   - 旧密码: `123456`
   - 新密码: `123`（少于6位）
   - 确认新密码: `123`
2. 点击"确认修改"
3. ✓ 应显示错误提示: "新密码长度必须在6-20个字符之间"

#### 5.3 测试新密码与旧密码相同
1. 输入:
   - 旧密码: `123456`
   - 新密码: `123456`
   - 确认新密码: `123456`
2. 点击"确认修改"
3. ✓ 应显示错误提示: "新密码不能与旧密码相同"

#### 5.4 测试两次密码不一致
1. 输入:
   - 旧密码: `123456`
   - 新密码: `newpass123`
   - 确认新密码: `newpass456`
2. 点击"确认修改"
3. ✓ 应显示错误提示: "两次输入的密码不一致"

#### 5.5 测试成功修改密码
1. 输入正确的数据:
   ```
   旧密码: 123456
   新密码: newpass123
   确认新密码: newpass123
   ```
2. 点击"确认修改"
3. ✓ 应显示成功提示: "密码修改成功，请重新登录"
4. ✓ 1.5秒后自动退出到登录页面

#### 5.6 测试使用新密码登录
1. 在登录页面输入:
   - 用户名: `admin`
   - 密码: `newpass123`（新密码）
2. 点击登录
3. ✓ 应成功登录并跳转到工作台

### 测试6: 测试重置按钮
1. 在修改密码页面填写任意内容
2. 点击"重置"按钮
3. ✓ 所有输入框应清空

## 后端API测试

### 测试API1: 获取教练信息
```bash
# 先登录获取token
curl -X POST http://localhost:9090/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'

# 使用返回的token获取教练信息
curl -X GET http://localhost:9090/coaches/info \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```
**期望结果**: 返回包含完整教练信息的JSON

### 测试API2: 更新用户信息
```bash
curl -X PUT http://localhost:9090/user/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "nickname": "张教练",
    "phone": "13800138000",
    "email": "coach@example.com",
    "avatar": "/images/avatar.jpg"
  }'
```
**期望结果**: 返回成功响应和更新后的用户信息

### 测试API3: 更新教练信息
```bash
curl -X PUT http://localhost:9090/coaches/info \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "specialty": "力量训练、体能训练",
    "introduction": "10年健身教练经验",
    "certificate": "国家级健身教练证书"
  }'
```
**期望结果**: 返回成功响应和更新后的教练信息

### 测试API4: 修改密码
```bash
curl -X PUT http://localhost:9090/user/password/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "oldPassword": "123456",
    "newPassword": "newpass123"
  }'
```
**期望结果**: 返回成功响应

## 测试检查清单

### 前端功能
- [ ] 个人信息页面能正常访问
- [ ] 个人信息页面数据正确加载
- [ ] 用户名和用户类型正确显示为只读
- [ ] 手机号格式验证正常
- [ ] 邮箱格式验证正常
- [ ] 昵称长度限制验证正常
- [ ] 个人信息保存成功
- [ ] 保存后右上角昵称更新
- [ ] 取消按钮功能正常
- [ ] 修改密码页面能正常访问
- [ ] 旧密码验证正常
- [ ] 新密码长度验证正常
- [ ] 新旧密码相同验证正常
- [ ] 两次密码一致性验证正常
- [ ] 密码修改成功
- [ ] 修改成功后自动退出
- [ ] 使用新密码能成功登录
- [ ] 重置按钮功能正常

### 后端功能
- [ ] 获取教练信息API正常
- [ ] 更新用户信息API正常
- [ ] 更新教练信息API正常
- [ ] 修改密码API正常
- [ ] 密码BCrypt加密正常
- [ ] JWT认证正常
- [ ] 权限验证正常

### 数据库
- [ ] user表数据正确更新
- [ ] gym_coach表数据正确更新
- [ ] 密码在数据库中已加密存储

## 常见问题排查

### 问题1: 页面无法访问
**检查**: 
- 确认后端服务已启动
- 确认前端服务已启动
- 检查浏览器控制台是否有错误

### 问题2: 获取不到用户信息
**检查**:
- 确认已登录
- 检查localStorage中是否有coach_token和coach_user
- 检查网络请求是否成功（F12开发者工具）

### 问题3: 提交表单无响应
**检查**:
- 打开浏览器开发者工具查看Network标签
- 查看请求是否发送
- 查看响应状态码和内容

### 问题4: 密码修改后无法登录
**检查**:
- 确认使用的是新密码
- 检查后端日志
- 检查数据库中密码是否更新

## 测试完成后

### 恢复测试数据
如果需要恢复测试账号密码为原始值:
```sql
-- 将admin账号密码重置为123456
UPDATE user 
SET password = '$2a$10$...' -- BCrypt加密后的123456
WHERE username = 'admin';
```

或使用忘记密码功能进行重置。

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________

个人信息编辑功能:
□ 通过  □ 失败  问题描述: _________________

修改密码功能:
□ 通过  □ 失败  问题描述: _________________

后端API:
□ 通过  □ 失败  问题描述: _________________

整体评价:
□ 优秀  □ 良好  □ 需要改进

改进建议:
_________________________________________
_________________________________________
```
