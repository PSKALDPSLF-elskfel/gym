# 学员管理功能 - 前端快速测试指南

## 🚀 快速开始

### 1. 环境准备

```bash
# 进入教练端项目目录
cd D:\健身房预约小程序\vue3\coach

# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

### 2. 配置后端API地址

修改 `.env.development` 文件：
```env
VITE_API_URL=http://localhost:8080/api
```

### 3. 确保后端服务运行

```bash
# 在另一个终端，启动后端服务
cd D:\健身房预约小程序\springboot
mvn spring-boot:run
```

---

## 📋 测试前准备

### 1. 数据库准备

确保已执行建表脚本：
```sql
-- 执行学员关系表建表脚本
SOURCE D:\健身房预约小程序\springboot\database\coach_student_system.sql;
```

### 2. 测试数据准备

```sql
-- 1. 创建教练用户
INSERT INTO user (user_type, nickname, phone, username, password, status) 
VALUES ('COACH', '李教练', '13900000001', 'coach1', '$2a$10$...', 1);

-- 2. 创建教练记录
INSERT INTO gym_coach (user_id, specialty, introduction, rating, status) 
VALUES (LAST_INSERT_ID(), '增肌/减脂', '资深健身教练', 4.8, 1);

-- 3. 创建学员用户
INSERT INTO user (user_type, nickname, phone, member_type, member_expire_time, status) 
VALUES 
  ('USER', '张三', '13800138000', 1, '2025-12-31 23:59:59', 1),
  ('USER', '李四', '13800138001', 2, '2026-06-30 23:59:59', 1),
  ('USER', '王五', '13800138002', 0, NULL, 1);

-- 4. 创建训练计划（建立师生关系）
INSERT INTO gym_training_plan (user_id, coach_id, name, goal, start_date, end_date, status) 
VALUES 
  (2, 1, '增肌训练计划V1', '增肌', '2025-11-01', '2025-12-31', 1),
  (3, 1, '减脂训练计划', '减脂', '2025-12-01', '2026-01-31', 1),
  (4, 1, '体能提升计划', '体能', '2025-12-10', '2026-02-10', 1);

-- 5. 创建体测数据
INSERT INTO gym_body_test (user_id, height, weight, bmi, body_fat, muscle_mass, visceral_fat, basal_metabolism, test_time, tester_id) 
VALUES 
  (2, 175.0, 75.5, 24.6, 18.5, 35.2, 8, 1680, '2025-12-01 14:00:00', 1),
  (2, 175.0, 77.0, 25.1, 20.5, 34.0, 9, 1650, '2025-11-01 14:00:00', 1),
  (3, 168.0, 65.0, 23.0, 22.0, 30.5, 7, 1450, '2025-12-02 15:00:00', 1);

-- 6. 添加教练备注
INSERT INTO gym_coach_student (coach_id, student_id, remark) 
VALUES 
  (1, 2, '训练态度积极，进步明显'),
  (1, 3, '需要加强饮食控制');
```

---

## 🧪 测试步骤

### 测试1：登录教练账号

1. 访问登录页：`http://localhost:5173/login`
2. 输入教练账号：
   - 用户名：`coach1`
   - 密码：（你设置的密码）
3. 点击登录
4. **预期结果**：
   - 登录成功，跳转到工作台
   - Token保存到浏览器

### 测试2：查看学员列表

1. 点击左侧菜单"学员管理"
2. **预期结果**：
   - 显示学员列表
   - 看到张三、李四、王五等学员
   - 显示会员类型标签（黄金、铂金、普通）
   - 显示训练计划数量
   - 显示教练备注

**检查要点**：
```
✓ 头像正常显示
✓ 昵称和手机号正确
✓ 会员类型标签颜色正确（黄金-金色，铂金-蓝色）
✓ 训练计划数量正确
✓ 备注显示正确
✓ 分页信息正确
```

### 测试3：搜索功能

**测试3.1：按昵称搜索**
1. 在搜索框输入"张三"
2. 点击搜索或按回车
3. **预期结果**：
   - 只显示"张三"的记录
   - 其他学员被过滤

**测试3.2：按手机号搜索**
1. 在搜索框输入"138"
2. 点击搜索
3. **预期结果**：
   - 显示所有手机号包含"138"的学员

**测试3.3：清空搜索**
1. 点击搜索框的清除按钮
2. **预期结果**：
   - 搜索框清空
   - 显示所有学员

### 测试4：筛选功能

**测试4.1：筛选黄金会员**
1. 选择会员类型：黄金会员
2. **预期结果**：
   - 只显示黄金会员
   - 其他会员类型被过滤

**测试4.2：筛选铂金会员**
1. 选择会员类型：铂金会员
2. **预期结果**：
   - 只显示铂金会员

**测试4.3：组合筛选**
1. 输入关键词"张"
2. 选择会员类型：黄金会员
3. 点击搜索
4. **预期结果**：
   - 同时满足两个条件的学员

**测试4.4：重置筛选**
1. 点击"重置"按钮
2. **预期结果**：
   - 所有筛选条件清空
   - 显示所有学员

### 测试5：分页功能

**测试5.1：切换页码**
1. 如果数据超过10条，点击第2页
2. **预期结果**：
   - 显示第2页数据
   - 页码高亮

**测试5.2：修改每页条数**
1. 选择每页显示20条
2. **预期结果**：
   - 列表刷新
   - 显示更多数据

### 测试6：编辑备注功能

**测试6.1：添加备注**
1. 找到一个没有备注的学员
2. 点击"修改备注"按钮
3. 在弹窗中输入备注内容："训练认真，建议增加力量训练"
4. 点击确定
5. **预期结果**：
   - 弹窗关闭
   - 提示"备注更新成功"
   - 列表刷新，显示新备注

**测试6.2：修改备注**
1. 找到已有备注的学员
2. 点击"修改备注"
3. 修改备注内容
4. 点击确定
5. **预期结果**：
   - 备注更新成功
   - 列表显示新内容

**测试6.3：清空备注**
1. 点击"修改备注"
2. 清空输入框
3. 点击确定
4. **预期结果**：
   - 备注被清空
   - 显示"暂无备注"

**测试6.4：取消编辑**
1. 点击"修改备注"
2. 修改内容
3. 点击取消
4. **预期结果**：
   - 弹窗关闭
   - 备注未改变

### 测试7：查看学员详情

**测试7.1：基本信息**
1. 点击任一学员的"查看详情"按钮
2. **预期结果**：
   - 跳转到详情页
   - 显示学员头像
   - 显示昵称、手机号
   - 显示会员类型和到期时间
   - 显示训练计划统计
   - 显示教练备注

**检查要点**：
```
✓ URL变为 /students/{userId}
✓ 所有信息显示正确
✓ 会员到期时间格式正确
✓ 训练计划数量准确
```

**测试7.2：最新体测数据**
1. 在详情页查看"最新体测数据"卡片
2. **预期结果**：
   - 显示体重、BMI、体脂率、肌肉量
   - 数据格式正确（保留小数）
   - 单位显示正确
   - 显示测试时间
   - 如有备注，显示备注内容

**测试7.3：体测历史**
1. 点击"展开"按钮
2. **预期结果**：
   - 显示体测历史时间轴
   - 按时间倒序排列
   - 每条记录显示完整数据
   - 时间格式正确

3. 点击"收起"按钮
4. **预期结果**：
   - 体测历史隐藏

**测试7.4：训练计划列表**
1. 查看训练计划卡片
2. **预期结果**：
   - 显示所有训练计划
   - 状态标签正确（进行中-绿色，已结束-灰色）
   - 显示目标和周期
   - 点击"查看详情"有提示（待实现）

**测试7.5：详情页编辑备注**
1. 在详情页点击"编辑备注"
2. 修改备注内容
3. 保存
4. **预期结果**：
   - 备注更新成功
   - 页面自动刷新
   - 新备注显示

**测试7.6：返回功能**
1. 点击页面顶部的返回按钮
2. **预期结果**：
   - 返回学员列表页
   - 列表数据保持

### 测试8：空数据状态

**测试8.1：无学员时**
1. 使用没有学员的教练账号登录
2. 进入学员管理
3. **预期结果**：
   - 显示空数据提示
   - 分页显示0条

**测试8.2：搜索无结果**
1. 搜索不存在的学员名称
2. **预期结果**：
   - 显示空数据提示
   - 提示"暂无数据"

**测试8.3：无体测数据**
1. 查看没有体测记录的学员详情
2. **预期结果**：
   - 最新体测数据显示"暂无体测数据"
   - 体测历史显示空状态

**测试8.4：无训练计划**
1. 查看没有训练计划的学员
2. **预期结果**：
   - 训练计划列表显示"暂无训练计划"

### 测试9：错误处理

**测试9.1：网络错误**
1. 关闭后端服务
2. 刷新学员列表
3. **预期结果**：
   - 显示加载状态
   - 显示错误提示
   - 不会白屏

**测试9.2：Token过期**
1. 清除浏览器Token
2. 尝试访问学员管理
3. **预期结果**：
   - 自动跳转到登录页
   - 提示"登录已过期"

**测试9.3：权限错误**
1. 使用非教练账号登录
2. 尝试访问学员管理
3. **预期结果**：
   - 显示错误提示
   - 或返回"当前用户不是教练"

---

## ✅ 测试检查清单

### 功能完整性
- [ ] 学员列表正常加载
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 分页功能正常
- [ ] 备注编辑功能正常
- [ ] 学员详情正常显示
- [ ] 体测数据正常显示
- [ ] 训练计划正常显示
- [ ] 返回功能正常

### 数据准确性
- [ ] 学员数量正确
- [ ] 会员类型正确
- [ ] 训练计划统计准确
- [ ] 体测数据准确
- [ ] 时间格式正确
- [ ] 备注内容正确

### 用户体验
- [ ] 加载状态显示
- [ ] 操作反馈及时
- [ ] 错误提示友好
- [ ] 空状态提示清晰
- [ ] 页面响应流畅
- [ ] 界面美观整洁

### 边界情况
- [ ] 无数据时正常显示
- [ ] 超长文本正常处理
- [ ] 特殊字符正常显示
- [ ] 网络错误正常提示
- [ ] Token过期正常跳转

---

## 🐛 常见问题排查

### 问题1：学员列表为空

**检查步骤**：
1. 打开浏览器控制台（F12）
2. 查看Network标签
3. 检查API请求是否成功

**可能原因**：
- 后端服务未启动
- 数据库无数据
- 教练没有创建训练计划
- Token无效

**解决方案**：
```bash
# 检查后端服务
curl http://localhost:8080/api/coach/students/my

# 检查数据库
SELECT * FROM gym_training_plan WHERE coach_id = 1;
```

### 问题2：404错误

**可能原因**：
- API路径错误
- 后端路由未配置

**解决方案**：
检查API路径是否为：`/api/coach/students/my`

### 问题3：401未授权

**可能原因**：
- Token过期或无效
- 未登录

**解决方案**：
1. 重新登录
2. 检查Token是否正确保存

### 问题4：CORS跨域错误

**解决方案**：
后端添加CORS配置（已在WebConfig中配置）

### 问题5：数据不刷新

**解决方案**：
1. 检查是否调用了`loadStudents()`
2. 检查分页参数是否正确
3. 清除浏览器缓存

---

## 📊 性能检查

### 加载速度
- [ ] 首屏加载时间 < 2秒
- [ ] API响应时间 < 500ms
- [ ] 页面切换流畅

### 网络请求
- [ ] 无重复请求
- [ ] 请求参数正确
- [ ] 响应数据完整

### 内存占用
- [ ] 无内存泄漏
- [ ] 组件正常销毁

---

## 📝 测试报告模板

```markdown
## 学员管理功能测试报告

**测试日期**：2025-12-11
**测试人员**：XXX
**测试环境**：
- 浏览器：Chrome 120
- 操作系统：Windows 11
- 后端版本：v1.0
- 前端版本：v1.0

### 测试结果
- 通过：XX项
- 失败：XX项
- 跳过：XX项

### 发现的问题
1. [问题描述]
   - 严重程度：高/中/低
   - 复现步骤：...
   - 预期结果：...
   - 实际结果：...

### 建议
1. ...
2. ...

### 总体评价
功能基本完善，可以发布。
```

---

## 🎯 下一步

测试通过后，可以进行：
1. 性能优化
2. 添加数据可视化（ECharts图表）
3. 移动端适配
4. 其他功能模块开发

---

**测试负责人**：开发团队  
**文档版本**：v1.0  
**更新时间**：2025-12-11
