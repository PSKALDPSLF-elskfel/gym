# 教练评价功能 - 测试指南

## 📋 测试准备

### 环境要求
- ✅ Node.js >= 16.0
- ✅ 后端服务已启动（SpringBoot）
- ✅ 数据库已导入评价相关表
- ✅ 有测试用的教练账号

### 启动步骤

#### 1. 启动后端服务
```bash
cd D:\健身房预约小程序\springboot
mvn spring-boot:run
```

#### 2. 启动前端服务
```bash
cd D:\健身房预约小程序\vue3\coach
npm install  # 首次运行需要安装依赖
npm run dev
```

#### 3. 访问应用
```
http://localhost:5173
```

---

## 🧪 功能测试

### 测试用例1: 登录教练账号

**步骤**:
1. 访问 http://localhost:5173
2. 自动跳转到登录页面
3. 输入教练账号
   - 用户名: `coach_li`
   - 密码: `123456`
4. 点击登录

**预期结果**:
- ✅ 登录成功，跳转到工作台
- ✅ 侧边栏显示"学员评价"菜单

---

### 测试用例2: 查看评价列表

**步骤**:
1. 点击侧边栏"学员评价"
2. 点击"评价列表"子菜单
3. 查看页面内容

**预期结果**:
- ✅ 顶部显示4个统计卡片（总评价数、平均评分、五星好评、回复率）
- ✅ 评价列表正确显示
- ✅ 每条评价显示：
  - 用户头像和昵称
  - 星级评分
  - 评价时间
  - 评价标签
  - 评价内容
  - 评价图片（如有）
  - 教练回复（如有）
  - 点赞数量

**截图示例**:
```
┌─────────────────────────────────────────┐
│ 总评价数    平均评分    五星好评   回复率 │
│   100        4.85        85       95%   │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 👤 张三  ⭐⭐⭐⭐⭐  2025-12-05 18:20   │
│ [专业] [耐心] [认真负责]                │
│ 李教练非常专业，课程讲解很细致...        │
│ 📷 [图片1] [图片2]                       │
│ 💬 我的回复：感谢您的认可！              │
│ 👍 15  [回复] [详情]                     │
└─────────────────────────────────────────┘
```

---

### 测试用例3: 筛选评价

**步骤**:
1. 在评价列表页面
2. 点击右上角"筛选评分"下拉框
3. 选择"⭐⭐⭐⭐⭐"（5星）

**预期结果**:
- ✅ 列表只显示5星评价
- ✅ 分页重置为第1页

**测试数据**:
```javascript
// 应该有3条5星评价（根据初始数据）
评价1: 5星 - "李教练非常专业..."
评价2: 5星 - "王教练的力量训练..."
评价3: 4星 - "动感单车课太燃了..."（不应显示）
```

---

### 测试用例4: 回复评价

**步骤**:
1. 找到一条未回复的评价
2. 点击"回复"按钮
3. 在弹窗中输入回复内容
   ```
   感谢您的认可，我会继续努力为大家提供更优质的教学服务！
   ```
4. 点击"确定"

**预期结果**:
- ✅ 显示"回复成功"提示
- ✅ 弹窗关闭
- ✅ 评价列表刷新，该评价显示教练回复
- ✅ 回复率统计更新
- ✅ "回复"按钮消失（已回复的评价）

**验证数据库**:
```sql
-- 查看回复是否保存
SELECT id, reply, reply_time 
FROM gym_coach_review 
WHERE id = ? AND reply IS NOT NULL;

-- 查看回复率是否更新
SELECT reply_rate 
FROM gym_coach_review_statistics 
WHERE coach_id = 1;
```

---

### 测试用例5: 查看评价详情

**步骤**:
1. 点击任意评价的"详情"按钮
2. 查看详情弹窗

**预期结果**:
- ✅ 弹窗显示评价完整信息
- ✅ 包含字段：
  - 评价用户
  - 评价类型
  - 评分
  - 标签
  - 评价内容
  - 评价图片
  - 点赞数
  - 评价时间
  - 回复内容（如有）
  - 回复时间（如有）

---

### 测试用例6: 分页功能

**步骤**:
1. 在评价列表底部
2. 点击"下一页"
3. 修改每页显示数量（10 → 20）

**预期结果**:
- ✅ 点击下一页，列表更新为第2页数据
- ✅ 修改每页数量，列表刷新显示20条
- ✅ 分页器显示正确的总页数

---

### 测试用例7: 查看评价统计

**步骤**:
1. 点击侧边栏"学员评价"
2. 点击"评价统计"子菜单

**预期结果**:
- ✅ 显示4个渐变色统计卡片
  - 紫色渐变：总评价数
  - 粉色渐变：平均评分
  - 蓝色渐变：回复率
  - 绿色渐变：五星好评
- ✅ 显示星级分布进度条
  - 5星到1星各一个进度条
  - 显示数量和百分比
- ✅ 显示最新5条评价
- ✅ 可以在最新评价中快速回复

---

### 测试用例8: 统计数据准确性

**步骤**:
1. 记录当前统计数据
2. 回复一条评价
3. 查看统计数据变化

**预期结果**:
- ✅ 回复率增加
- ✅ 其他数据保持不变

**计算验证**:
```javascript
// 假设初始数据
总评价数: 100
已回复数: 95
回复率: 95%

// 回复一条后
总评价数: 100
已回复数: 96
回复率: 96%  // 应该更新为96%
```

---

### 测试用例9: 图片预览

**步骤**:
1. 找到有图片的评价
2. 点击图片

**预期结果**:
- ✅ 打开图片预览
- ✅ 可以左右切换图片
- ✅ 可以放大缩小
- ✅ 点击遮罩或关闭按钮关闭预览

---

### 测试用例10: 刷新功能

**步骤**:
1. 在评价列表页面
2. 点击右上角"刷新"按钮

**预期结果**:
- ✅ 显示加载状态
- ✅ 重新加载评价列表
- ✅ 统计数据更新

---

## 🔍 边界测试

### 边界1: 无评价数据

**步骤**:
1. 使用没有收到评价的教练账号登录
2. 查看评价列表

**预期结果**:
- ✅ 统计卡片显示0
- ✅ 列表显示空状态提示
- ✅ 不报错

---

### 边界2: 大量评价数据

**准备数据**:
```sql
-- 插入100条测试评价
INSERT INTO gym_coach_review (...) VALUES (...);
-- 重复100次
```

**测试**:
1. 查看评价列表
2. 切换分页

**预期结果**:
- ✅ 分页正常工作
- ✅ 加载速度可接受（< 2秒）
- ✅ 统计数据正确

---

### 边界3: 回复内容验证

**测试数据**:
```
空内容: ""
只有空格: "   "
超长内容: "A" * 301  (超过300字)
特殊字符: "<script>alert(1)</script>"
```

**预期结果**:
- ✅ 空内容提示"请输入回复内容"
- ✅ 只有空格同样提示
- ✅ 超长内容被限制在300字
- ✅ 特殊字符正确转义

---

## 🐛 异常测试

### 异常1: 网络错误

**模拟**:
1. 关闭后端服务
2. 尝试加载评价列表

**预期结果**:
- ✅ 显示错误提示
- ✅ 不显示加载状态
- ✅ 页面不崩溃

---

### 异常2: Token过期

**模拟**:
1. 修改localStorage中的token为无效值
2. 刷新页面或进行操作

**预期结果**:
- ✅ 自动跳转到登录页
- ✅ 提示"请重新登录"

---

### 异常3: 权限问题

**测试**:
1. 使用普通用户账号登录
2. 尝试访问 `/reviews/list`

**预期结果**:
- ✅ 被拦截或提示无权限
- ✅ 不显示评价数据

---

## 📱 响应式测试

### 移动端适配

**步骤**:
1. 打开Chrome开发者工具 (F12)
2. 切换到设备模拟模式
3. 选择iPhone 12 Pro
4. 测试所有功能

**检查点**:
- ✅ 统计卡片自适应布局
- ✅ 评价列表适配移动端
- ✅ 按钮和操作区域足够大
- ✅ 弹窗适配屏幕宽度
- ✅ 图片预览正常

---

## ⚡ 性能测试

### 加载性能

**检查点**:
- ✅ 首屏加载时间 < 2秒
- ✅ 评价列表加载 < 1秒
- ✅ 图片懒加载
- ✅ 无明显卡顿

**工具**: Chrome Lighthouse

**期望分数**:
- Performance: > 90
- Accessibility: > 90
- Best Practices: > 90

---

## 📊 测试报告模板

### 测试环境
- 浏览器: Chrome 120.0
- 系统: Windows 11
- 分辨率: 1920x1080
- 网络: 本地局域网

### 测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 登录功能 | ✅ PASS | - |
| 评价列表 | ✅ PASS | - |
| 筛选功能 | ✅ PASS | - |
| 回复评价 | ✅ PASS | - |
| 查看详情 | ✅ PASS | - |
| 分页功能 | ✅ PASS | - |
| 统计展示 | ✅ PASS | - |
| 图片预览 | ✅ PASS | - |

### 发现的问题
1. 无

### 建议优化
1. 添加加载骨架屏
2. 优化移动端体验
3. 添加下拉刷新

---

## 🛠️ 调试技巧

### 1. 查看网络请求
```javascript
// 打开浏览器开发者工具 (F12)
// Network标签 → 查看API请求和响应
```

### 2. 查看Vue组件状态
```javascript
// 安装 Vue Devtools 扩展
// 可以查看组件的data、computed、methods
```

### 3. 查看Console日志
```javascript
// Console标签 → 查看错误信息
```

### 4. 断点调试
```javascript
// Sources标签 → 找到对应的.vue文件 → 设置断点
```

---

## ✅ 测试检查清单

### 功能测试
- [ ] 登录功能正常
- [ ] 评价列表显示正常
- [ ] 统计数据显示正确
- [ ] 筛选功能正常
- [ ] 分页功能正常
- [ ] 回复评价功能正常
- [ ] 查看详情功能正常
- [ ] 图片预览功能正常
- [ ] 刷新功能正常

### UI测试
- [ ] 样式显示正常
- [ ] 响应式布局正常
- [ ] 图标显示正常
- [ ] 颜色搭配合理
- [ ] 字体大小合适

### 性能测试
- [ ] 页面加载速度快
- [ ] 无明显卡顿
- [ ] 图片加载正常
- [ ] 内存占用合理

### 兼容性测试
- [ ] Chrome浏览器正常
- [ ] Firefox浏览器正常
- [ ] Edge浏览器正常
- [ ] 移动端显示正常

---

## 🎯 自动化测试（可选）

### 单元测试
```javascript
// 测试API调用
import { describe, it, expect } from 'vitest'
import { getReceivedReviews } from '@/api/review'

describe('Review API', () => {
  it('should get reviews list', async () => {
    const res = await getReceivedReviews({ pageNum: 1, pageSize: 10 })
    expect(res.data).toBeDefined()
    expect(res.data.records).toBeInstanceOf(Array)
  })
})
```

### E2E测试
```javascript
// 使用Cypress
describe('Review List', () => {
  it('should display reviews', () => {
    cy.visit('/reviews/list')
    cy.get('.ant-list-item').should('have.length.greaterThan', 0)
  })
})
```

---

## 📞 问题反馈

如发现问题，请提供：
1. 问题描述
2. 复现步骤
3. 截图或录屏
4. 浏览器和系统信息
5. Console错误信息

---

**祝测试顺利！** ✨
