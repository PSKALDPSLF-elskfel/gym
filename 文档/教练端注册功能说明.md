# 教练端注册功能说明

## 功能概述

教练端新增了用户注册功能，允许新用户通过注册页面创建账号。该功能支持教练和管理员两种账户类型的注册。

## 功能特性

### 1. 注册表单字段

- **用户名**：3-50个字符，仅支持字母、数字和下划线
- **邮箱**：有效的电子邮箱地址
- **手机号**：11位中国大陆手机号
- **昵称**：选填，如不填写则默认使用用户名
- **密码**：6-50个字符
- **确认密码**：需与密码一致
- **账户类型**：选择教练或管理员

### 2. 表单验证

- ✅ 用户名格式验证（长度、字符限制）
- ✅ 邮箱格式验证
- ✅ 手机号格式验证（1开头的11位数字）
- ✅ 密码长度验证
- ✅ 两次密码一致性验证
- ✅ 所有必填项验证

## 3. 后端验证

- 用户名唯一性检查
- 邮箱唯一性检查
- 密码加密存储（BCrypt）
- 用户类型合法性验证
- **教练类型自动创建教练信息**：当用户类型为COACH时，同时在`gym_coach`表中创建教练记录（修复"当前用户不是教练"错误）

## 文件结构

### 前端文件

```
vue3/coach/src/
├── views/auth/
│   ├── Login.vue          # 登录页面（已更新，添加注册链接）
│   └── Register.vue       # 注册页面（新增）
└── router/
    └── index.js           # 路由配置（已更新）
```

### 后端接口

- **接口地址**：`POST /user/add`
- **请求体**：
```json
{
  "username": "string",
  "email": "string",
  "phone": "string",
  "nickname": "string",
  "password": "string",
  "confirmPassword": "string",
  "userType": "COACH" // 或 "ADMIN"
}
```
- **响应示例**：
```json
{
  "code": 200,
  "msg": "注册成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "userType": "COACH",
    ...
  }
}
```

## 使用流程

### 1. 访问注册页面

- 方式1：在登录页面点击"立即注册"链接
- 方式2：直接访问 `http://localhost:5173/register`

### 2. 填写注册信息

1. 输入用户名（必填）
2. 输入邮箱（必填）
3. 输入手机号（必填）
4. 输入昵称（选填）
5. 设置密码（必填，至少6位）
6. 确认密码（必填）
7. 选择账户类型（默认为教练）

### 3. 提交注册

点击"注册"按钮后：
- ✅ 表单验证通过 → 发送请求到后端
- ✅ 后端验证通过 → 创建账户成功
- ✅ 注册成功 → 显示成功提示，1.5秒后自动跳转到登录页面
- ❌ 验证失败 → 显示具体错误信息

### 4. 登录使用

注册成功后，使用注册的用户名和密码登录系统。

## 路由配置

### 注册路由

```javascript
{
  path: '/register',
  name: 'Register',
  component: () => import('@/views/auth/Register.vue'),
  meta: { title: '注册' }
}
```

### 路由守卫规则

- 已登录用户访问注册页面 → 自动跳转到工作台
- 未登录用户可以正常访问注册页面

## 错误处理

### 常见错误及解决方案

1. **用户名已存在**
   - 错误信息：用户名已存在
   - 解决方案：更换其他用户名

2. **邮箱已被注册**
   - 错误信息：邮箱已被注册
   - 解决方案：使用其他邮箱或找回已有账号

3. **两次密码不一致**
   - 错误信息：两次输入的密码不一致
   - 解决方案：确保两次输入的密码完全一致

4. **格式验证失败**
   - 错误信息：对应字段的格式要求提示
   - 解决方案：按照提示要求修改输入内容

## 安全特性

- ✅ 密码前端不明文传输
- ✅ 密码后端BCrypt加密存储
- ✅ 表单防重复提交（loading状态）
- ✅ 完整的输入验证（前端+后端双重验证）
- ✅ 用户名和邮箱唯一性校验

## 测试建议

### 测试用例

1. **正常注册流程**
   - 填写所有必填项
   - 提交注册
   - 验证注册成功并跳转到登录页

2. **表单验证测试**
   - 测试各字段的格式验证
   - 测试必填项验证
   - 测试密码一致性验证

3. **重复数据测试**
   - 使用已存在的用户名注册
   - 使用已存在的邮箱注册
   - 验证系统给出正确提示

4. **界面交互测试**
   - 点击"立即登录"跳转到登录页
   - 已登录状态访问注册页自动跳转
   - 注册成功后自动跳转

## 开发技术栈

- **前端框架**：Vue 3 (Composition API)
- **UI组件库**：Ant Design Vue
- **路由**：Vue Router
- **HTTP客户端**：Axios（封装在 request.js）
- **状态管理**：Pinia
- **后端框架**：Spring Boot
- **密码加密**：BCrypt

## 注意事项

1. 注册时默认账户类型为"COACH"（教练）
2. 昵称为可选项，如果不填写，系统将使用用户名作为昵称
3. 注册成功后不会自动登录，需要手动使用注册的账号密码登录
4. 手机号仅支持中国大陆11位手机号格式
5. 用户名一旦注册不可修改（当前版本）

## 后续优化建议

- [ ] 添加手机验证码功能
- [ ] 添加邮箱验证功能
- [ ] 支持第三方账号注册（微信、QQ等）
- [ ] 添加图形验证码防止恶意注册
- [ ] 优化用户体验（如显示密码强度）
- [ ] 添加用户协议和隐私政策勾选

## 相关文件

- 前端注册页面：`vue3/coach/src/views/auth/Register.vue`
- 前端登录页面：`vue3/coach/src/views/auth/Login.vue`
- 前端路由配置：`vue3/coach/src/router/index.js`
- 后端控制器：`springboot/src/main/java/org/example/springboot/controller/UserController.java`
- 后端服务层：`springboot/src/main/java/org/example/springboot/service/UserService.java`
- 后端DTO：`springboot/src/main/java/org/example/springboot/dto/command/UserRegisterCommandDTO.java`
