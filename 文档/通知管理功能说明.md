# 通知管理功能说明

## 功能概述

通知管理功能允许管理员通过管理端向不同类型的用户发送系统通知，支持多种通知类型和优先级设置。

## 主要功能

### 1. 通知列表管理

- **分页查询**：支持分页展示所有通知记录
- **条件筛选**：
  - 通知类型：系统通知、预约提醒、课程相关、器材相关、会员相关
  - 目标用户类型：小程序用户、管理员、教练、全部
  - 状态：已删除、已发送、草稿

### 2. 发送通知

#### 基本信息
- **通知类型**（必填）：
  - SYSTEM：系统通知
  - BOOKING：预约提醒
  - COURSE：课程相关
  - EQUIPMENT：器材相关
  - MEMBERSHIP：会员相关

- **通知标题**（必填）：最多200个字符
- **通知内容**（必填）：最多1000个字符

#### 目标用户设置
- **目标用户类型**（必填）：
  - USER：小程序用户
  - ADMIN：管理员
  - COACH：教练
  - ALL：全部用户类型

#### 其他设置
- **优先级**：低、中、高
- **通知图标**：可选，输入图标URL
- **关联业务ID**：可选，关联具体的业务记录
- **关联业务类型**：课程、预约、器材、会员
- **是否需要已读**：设置用户是否需要标记已读
- **备注**：可选，内部备注信息

### 3. 通知详情查看

点击"详情"按钮可查看通知的完整信息，包括：
- 基本信息（ID、类型、标题、内容）
- 目标用户信息
- 优先级和状态
- 关联业务信息
- 发送时间和定时发送时间
- 创建和更新时间

### 4. 删除通知

- 管理端可物理删除通知记录
- 删除后将同时删除所有相关的读取记录
- 操作不可恢复，请谨慎操作

## 数据库表结构

### sys_notification（系统通知表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | bigint | 通知ID |
| notification_type | varchar(50) | 通知类型 |
| title | varchar(200) | 通知标题 |
| content | text | 通知内容 |
| target_user_type | varchar(20) | 目标用户类型 |
| target_user_id | bigint | 目标用户ID（NULL表示群发） |
| related_id | varchar(100) | 关联业务ID |
| related_type | varchar(50) | 关联业务类型 |
| icon | varchar(255) | 通知图标URL |
| priority | int | 优先级：0-低，1-中，2-高 |
| status | int | 状态：0-已删除，1-已发送，2-草稿 |
| send_time | datetime | 发送时间 |
| scheduled_time | datetime | 定时发送时间 |
| is_read_required | int | 是否需要标记已读 |
| remark | text | 备注 |

### sys_notification_read（通知读取记录表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | bigint | 记录ID |
| notification_id | bigint | 通知ID |
| user_id | bigint | 用户ID |
| is_read | int | 是否已读：0-未读，1-已读 |
| read_time | datetime | 读取时间 |

## 后端API接口

### 1. 获取通知列表（管理端）
```
GET /notifications/admin/list
参数：
- current: 页码
- size: 每页数量
- notificationType: 通知类型（可选）
- targetUserType: 目标用户类型（可选）
- status: 状态（可选）
```

### 2. 发送通知
```
POST /notifications/send
请求体：NotificationCreateDTO
```

### 3. 批量发送通知
```
POST /notifications/send/batch
参数：
- userIds: 用户ID列表
请求体：NotificationCreateDTO
```

### 4. 删除通知（管理端）
```
DELETE /notifications/admin/{notificationId}
```

## 前端页面路径

- 访问路径：`/back/notification`
- 菜单位置：后台管理 -> 通知管理

## 使用场景示例

### 场景1：发送系统维护通知
1. 点击"发送通知"按钮
2. 选择通知类型：系统通知
3. 输入标题：系统维护通知
4. 输入内容：本系统将于本周日凌晨2:00-4:00进行系统维护...
5. 选择目标用户类型：全部
6. 设置优先级：高
7. 点击确定发送

### 场景2：发送课程提醒
1. 点击"发送通知"按钮
2. 选择通知类型：课程相关
3. 输入标题和内容
4. 选择目标用户类型：小程序用户
5. 填写关联业务ID（课程ID）
6. 选择关联业务类型：课程
7. 点击确定发送

### 场景3：查看和管理通知
1. 使用筛选条件查询特定类型的通知
2. 点击"详情"查看通知完整信息
3. 对于不需要的通知，点击"删除"进行清理

## 注意事项

1. **权限控制**：通知管理功能仅限管理员使用
2. **删除操作**：删除操作不可恢复，请谨慎操作
3. **群发通知**：向"全部"用户类型发送通知时，系统会自动为所有符合条件的用户创建读取记录
4. **通知内容**：建议控制通知内容长度，确保用户能够快速理解
5. **优先级设置**：合理设置优先级，避免过度使用高优先级

## 技术实现

### 前端技术栈
- Vue 3 + Composition API
- Ant Design Vue 4.x
- Vue Router

### 后端技术栈
- Spring Boot 3.x
- MyBatis Plus
- MySQL

### 核心文件
- 前端API：`/src/api/NotificationApi.js`
- 前端页面：`/src/views/backend/notification/index.vue`
- 后端Controller：`NotificationController.java`
- 后端Service：`NotificationService.java`
- 实体类：`SysNotification.java`、`SysNotificationRead.java`
- DTO：`NotificationCreateDTO.java`、`NotificationResponseDTO.java`
