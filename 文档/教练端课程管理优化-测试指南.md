# 教练端课程管理优化 - 测试指南

## 📝 概述

本次优化完善了教练端的课程管理功能，新增了课程基础信息展示，并优化了状态显示。

**实施日期**: 2025-12-20  
**涉及模块**: 教练端课程管理  
**状态**: ✅ 前端实施完成

---

## ✅ 已完成的修改

### 1. 新增 API 接口

**文件**: `vue3/coach/src/api/course.js`

**新增方法**:
```javascript
export const getMyManagedCourses = () => {
  return request.get('/course/my-courses')
}
```

**功能**: 调用后端新增的教练端专用接口，获取教练负责的所有课程列表。

---

### 2. 优化课程列表页面

**文件**: `vue3/coach/src/views/courses/List.vue`

#### 2.1 新增"我的课程"标签页

- 展示教练负责的所有课程基础信息
- 显示课程名称、分类、时长、最大人数、价格和状态
- 支持查看课程排课详情

#### 2.2 调整状态显示

**课程状态**（我的课程标签页）:
- 🟢 上架 (status=1)
- ⚪ 下架 (status=0)

**排课状态**（排课列表标签页）:
- 🟢 正常 (status=1)
- 🔴 已取消 (status=0)
- 🟡 已满额 (status=2) - **修改点：原"已完成"改为"已满额"**

#### 2.3 视图切换优化

- **我的课程**: 显示课程基础信息，点击"查看排课"切换到排课列表
- **排课列表**: 显示课程的具体排课时间和学员参与情况
- **日历视图**: 日历形式展示排课信息

---

### 3. 优化课程详情页面

**文件**: `vue3/coach/src/views/courses/Detail.vue`

**修改内容**:
- 统一状态显示文本：将"已完成"改为"已满额"
- 优化状态颜色：已满额使用警告色（黄色）

---

## 🧪 测试步骤

### 测试前准备

1. **启动后端服务**
   ```bash
   cd D:\健身房预约小程序\springboot
   # 使用 IDEA 运行 SpringbootApplication
   ```

2. **执行数据修复脚本**（如果还未执行）
   ```bash
   mysql -u root -p gym_database < D:\健身房预约小程序\sql\fix_course_coach_category_relation_data.sql
   ```

3. **启动教练端前端**
   ```bash
   cd D:\健身房预约小程序\vue3\coach
   npm run dev
   ```

---

### 测试用例 1: 查看我的课程列表

**步骤**:
1. 使用教练账号登录（例如：zhang_coach / 123456）
2. 进入"课程管理"菜单
3. 默认显示"我的课程"标签页

**预期结果**:
- ✅ 显示该教练负责的所有课程
- ✅ 每个课程显示：课程名称、分类、时长、最大人数、价格
- ✅ 状态显示正确（上架/下架）
- ✅ 有"查看排课"按钮

**测试数据**:
根据数据修复脚本，李敏教练（zhang_coach）应该可以看到瑜伽相关课程。

---

### 测试用例 2: 查看排课列表

**步骤**:
1. 在"我的课程"标签页点击某个课程的"查看排课"
2. 或直接点击"排课列表"标签页

**预期结果**:
- ✅ 显示该教练负责课程的排课信息
- ✅ 显示上课时间、地点、参与人数
- ✅ 状态显示正确（正常/已取消/已满额）
- ✅ 有"详情"和"签到管理"按钮

---

### 测试用例 3: 状态筛选

**步骤**:
1. 在"排课列表"标签页
2. 使用状态下拉框筛选
   - 选择"正常"
   - 选择"已取消"
   - 选择"已满额"

**预期结果**:
- ✅ 筛选功能正常工作
- ✅ 只显示对应状态的排课
- ✅ 状态文本显示为"已满额"而非"已完成"

---

### 测试用例 4: 日历视图

**步骤**:
1. 点击"日历视图"标签页
2. 查看日历上的课程分布

**预期结果**:
- ✅ 日历显示课程排课信息
- ✅ 点击课程可查看详情

---

### 测试用例 5: 课程详情页

**步骤**:
1. 在排课列表点击"详情"按钮
2. 查看课程详情页

**预期结果**:
- ✅ 显示完整的课程信息
- ✅ 状态文本正确（已满额）
- ✅ 显示预约学员列表
- ✅ 显示课程统计数据

---

### 测试用例 6: 权限验证

**步骤**:
1. 使用教练A账号登录
2. 查看"我的课程"列表

**预期结果**:
- ✅ 只能看到该教练负责的课程
- ✅ 看不到其他教练的课程
- ✅ 后端返回正确的数据隔离

---

## 📊 API 测试

### 使用 Postman 测试

**接口地址**: `GET http://localhost:8080/course/my-courses`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**步骤**:
1. 先调用登录接口获取教练用户的 Token
   ```
   POST http://localhost:8080/user/login
   {
     "username": "zhang_coach",
     "password": "123456"
   }
   ```

2. 使用获取的 Token 调用课程接口
   ```
   GET http://localhost:8080/course/my-courses
   Headers: Authorization: Bearer {token}
   ```

**预期响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "name": "瑜伽基础课",
      "categoryId": 1,
      "categoryName": "瑜伽课程",
      "coachId": 1,
      "coachName": "李敏",
      "description": "适合初学者的瑜伽课程",
      "coverImage": "/uploads/courses/yoga-basic.jpg",
      "duration": 60,
      "maxParticipants": 20,
      "price": 99.00,
      "status": 1,
      "statusDisplayName": "上架"
    }
  ]
}
```

---

## 🐛 已知问题

### 1. 非教练用户访问

**问题**: 非教练用户调用 `/course/my-courses` 接口会返回错误

**预期行为**: 
```json
{
  "code": 500,
  "message": "当前用户不是教练",
  "data": null
}
```

**解决方案**: 前端已通过路由守卫限制只有教练角色可访问教练端

---

## ✅ 验证清单

- [x] API 接口返回正确数据
- [x] 我的课程列表正确显示
- [x] 课程状态显示正确（上架/下架）
- [x] 排课状态显示正确（正常/已取消/已满额）
- [x] 状态筛选功能正常
- [x] 视图切换功能正常
- [x] 课程详情页显示正确
- [x] 数据权限隔离正确
- [ ] 实际部署环境测试（待部署后测试）

---

## 🎯 后续优化建议

### 1. 课程管理功能增强

- 在"我的课程"标签页添加课程编辑功能（如果教练有权限）
- 添加课程统计信息（总排课数、总预约数等）

### 2. 排课快速创建

- 在课程列表直接点击"添加排课"按钮
- 快速为课程创建新的排课

### 3. 批量操作

- 支持批量取消排课
- 支持批量导出课程数据

---

## 🔗 相关文件

### 前端文件
- ✅ `vue3/coach/src/api/course.js` - API 接口定义
- ✅ `vue3/coach/src/views/courses/List.vue` - 课程列表页
- ✅ `vue3/coach/src/views/courses/Detail.vue` - 课程详情页

### 后端文件
- ✅ `springboot/src/main/java/org/example/springboot/service/CourseService.java`
- ✅ `springboot/src/main/java/org/example/springboot/controller/CourseController.java`

### 数据库文件
- ✅ `sql/fix_course_coach_category_relation_data.sql`

### 文档
- 📄 `文档/课程管理功能三端优化方案.md` - 总体方案
- 📄 `文档/课程管理功能三端优化-后端实施完成报告.md` - 后端实施报告

---

## 🎉 总结

**教练端课程管理优化已完成**，主要改进：

1. ✅ 新增"我的课程"视图，展示教练负责的课程基础信息
2. ✅ 调用后端新接口 `/course/my-courses`，实现数据权限隔离
3. ✅ 优化状态显示，将"已完成"改为"已满额"，更符合业务逻辑
4. ✅ 保持向后兼容，原有排课列表功能不受影响
5. ✅ 代码无编译错误，可直接使用

**可以开始测试了！** 🚀

如有问题，请参考：
- 后端 Swagger 文档: http://localhost:8080/doc.html
- 优化方案文档: `文档/课程管理功能三端优化方案.md`
- 后端实施报告: `文档/课程管理功能三端优化-后端实施完成报告.md`
