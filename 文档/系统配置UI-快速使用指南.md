# 系统配置UI - 快速使用指南

## 🚀 5分钟快速开始

### 第一步：初始化配置数据（首次使用）

```bash
# 在MySQL中执行初始化脚本
mysql -u root -p gym < springboot/database/system_config_init.sql
```

### 第二步：访问配置页面

1. 启动后端服务和前端服务
2. 登录后台管理系统 (http://localhost:5173/auth/login)
3. 点击侧边栏 **"配置设置"** 菜单

### 第三步：配置系统参数

根据需要配置以下三个模块：

---

## 📱 微信配置

### 必填项

| 配置项 | 说明 | 示例 |
|--------|------|------|
| 小程序AppID | 从微信公众平台获取 | wxdae24e45d0dcbaa6 |
| 小程序AppSecret | 从微信公众平台获取 | （32位字符串） |

### 可选项（启用微信支付时填写）

| 配置项 | 说明 | 获取方式 |
|--------|------|---------|
| 商户号 | 微信支付商户号 | 微信商户平台 |
| API V3密钥 | 支付接口密钥 | 微信商户平台 → 账户中心 → API安全 |
| 支付回调地址 | 支付成功回调URL | 填写实际域名地址 |
| 商户私钥路径 | 证书文件路径 | 默认: classpath:apiclient_key.pem |

**配置步骤**：
1. 切换到 **"微信配置"** 标签页
2. 填写对应的配置项
3. 点击 **"保存配置"** 按钮

---

## 📁 文件上传配置

### 基础配置

| 配置项 | 说明 | 默认值 | 建议值 |
|--------|------|--------|--------|
| 文件存储路径 | 上传文件保存位置 | ./files | ./files 或 /var/www/files |
| 访问路径前缀 | 文件访问URL前缀 | /files | /files 或 https://cdn.xxx.com |
| 最大文件大小 | 单个文件大小限制 | 10MB | 10-50MB |

### 高级配置

| 配置项 | 说明 | 建议 |
|--------|------|------|
| 允许的文件类型 | 可上传的文件扩展名 | 根据业务需求选择 |
| 图片压缩 | 自动压缩上传图片 | 建议启用 |
| 图片质量 | 压缩后图片质量 | 80% |

**配置步骤**：
1. 切换到 **"文件上传配置"** 标签页
2. 设置文件存储路径和访问前缀
3. 调整最大文件大小（拖动滑块）
4. 选择允许的文件类型
5. 启用图片压缩并设置质量
6. 点击 **"保存配置"** 按钮

---

## ⚙️ 系统配置

### 基本信息

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 系统名称 | 显示在页面标题 | 健身房预约管理系统 |
| 系统版本 | 当前系统版本号 | 1.0.0 |
| 系统描述 | 系统简介 | （可选） |

### 安全配置

| 配置项 | 说明 | 默认值 | 建议 |
|--------|------|--------|------|
| 会话超时时间 | 用户登录保持时长 | 120分钟 | 60-240分钟 |
| 密码复杂度检查 | 强制复杂密码 | 关闭 | 生产环境建议开启 |

**配置步骤**：
1. 切换到 **"系统配置"** 标签页
2. 填写系统基本信息
3. 设置会话超时时间
4. 决定是否启用密码复杂度检查
5. 点击 **"保存配置"** 按钮

---

## 💡 常见使用场景

### 场景1：配置微信小程序登录

```
目标：让用户可以使用微信登录小程序

步骤：
1. 进入微信配置页面
2. 填写 "小程序AppID" = wxdae24e45d0dcbaa6
3. 填写 "小程序AppSecret" = （从微信公众平台获取）
4. 保存配置
5. 重启后端服务
```

### 场景2：启用微信支付功能

```
前提：已完成微信小程序登录配置

步骤：
1. 在微信商户平台获取商户号和API V3密钥
2. 下载商户私钥文件到 resources 目录
3. 进入微信配置页面
4. 填写商户号、API V3密钥
5. 设置支付回调地址 = https://yourdomain.com/api/pay/notify
6. 保存配置
7. 重启后端服务
```

### 场景3：限制上传文件大小

```
目标：只允许上传小于5MB的图片

步骤：
1. 进入文件上传配置页面
2. 设置 "最大文件大小" = 5 MB
3. 在 "允许的文件类型" 中只选择 jpg, jpeg, png
4. 保存配置
5. 无需重启，立即生效
```

### 场景4：启用图片压缩节省空间

```
目标：自动压缩上传的图片

步骤：
1. 进入文件上传配置页面
2. 开启 "图片压缩" 开关
3. 设置 "图片质量" = 80%
4. 保存配置
```

---

## 🔧 配置验证

### 验证微信配置

```bash
# 在浏览器访问
http://localhost:8888/api/sys-configs/key/wechat.appid

# 应返回
{
  "code": 200,
  "data": "wxdae24e45d0dcbaa6",
  "message": "操作成功"
}
```

### 验证文件配置

```bash
# 查询所有文件配置
http://localhost:8888/api/sys-configs/page?configGroup=文件配置
```

### 验证配置是否生效

1. 修改配置后，查看浏览器 Network 面板
2. 确认返回状态码为 200
3. 查看成功提示消息
4. 刷新页面，确认配置已更新

---

## ⚠️ 注意事项

### 1. 敏感信息安全

- ❌ 不要在前端显示完整的 AppSecret 和 API密钥
- ✅ 使用密码框显示敏感配置
- ✅ 生产环境建议使用环境变量

### 2. 配置生效时机

| 配置类型 | 生效方式 |
|---------|---------|
| 微信配置 | 需要重启后端服务 |
| 文件配置 | 部分立即生效，部分需重启 |
| 系统配置 | 立即生效 |

### 3. 文件路径配置

**Windows系统**：
```
./files          # 相对路径（推荐）
D:/files         # 绝对路径（注意使用正斜杠）
```

**Linux系统**：
```
./files          # 相对路径（推荐）
/var/www/files   # 绝对路径
```

### 4. 回调地址配置

- 开发环境：使用内网穿透工具（如ngrok）获取临时域名
- 生产环境：使用实际域名，确保可公网访问

---

## 🐛 故障排查

### 问题1：保存配置失败

**症状**：点击保存后提示错误

**检查**：
1. 浏览器控制台是否有错误
2. 后端服务是否正常运行
3. 数据库连接是否正常

**解决**：
```bash
# 检查后端日志
tail -f springboot/logs/spring.log

# 检查数据库
mysql -u root -p
USE gym;
SELECT * FROM sys_config;
```

### 问题2：配置不生效

**症状**：保存成功但系统仍使用旧配置

**检查**：
1. 是否重启了后端服务
2. Redis缓存是否需要清除
3. 配置读取代码是否正确

**解决**：
```bash
# 重启后端服务
# Ctrl + C 停止服务，然后重新启动

# 清除Redis缓存（如果使用）
redis-cli
FLUSHDB
```

### 问题3：文件上传失败

**症状**：配置保存成功但文件上传仍失败

**检查**：
1. 文件存储路径是否存在
2. 文件大小是否超出限制
3. 文件类型是否在允许列表中

**解决**：
```bash
# 创建文件存储目录
mkdir -p ./files

# 设置目录权限（Linux）
chmod 755 ./files
```

---

## 📚 相关文档

- [模块15实现总结](./模块15-系统配置UI完善实现总结.md)
- [缺失功能开发计划](../../缺失功能开发计划.md)
- [系统配置表设计](../../gym.sql)

---

## 🎯 下一步

配置完成后，可以继续：

1. ✅ 测试微信小程序登录
2. ✅ 测试文件上传功能
3. ✅ 配置其他模块（如会员充值、器材管理等）
4. ✅ 进行系统整体测试

---

**提示**：首次使用建议先在测试环境配置，验证无误后再在生产环境配置。

**更新时间**：2025-12-12  
**文档版本**：v1.0
