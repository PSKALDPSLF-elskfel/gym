# æ–‡ä»¶ä¸Šä¼ è·¯å¾„é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶ä¿å­˜åœ¨äº† `D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\files\` ç›®å½•ï¼Œä½†æ˜¯ç³»ç»Ÿé…ç½®çš„æ–‡ä»¶è®¿é—®è·¯å¾„å´æŒ‡å‘ `D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\springboot\files\`ï¼Œå¯¼è‡´å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

### æŠ¥é”™ä¿¡æ¯
```
å›¾ç‰‡åŠ è½½å¤±è´¥: {
  courseId: '550e8400-e29b-41d4-a716-446655440001',
  courseName: 'ç‘œä¼½åŸºç¡€è¯¾',
  coverImage: '/files/bussiness/course/1765961672953.jpg',
  fullUrl: '/files/bussiness/course/1765961672953.jpg'
}
```

## é—®é¢˜æ ¹æº

### 1. FileUtil.java ç¡¬ç¼–ç è·¯å¾„é—®é¢˜

**åŸä»£ç ï¼ˆç¬¬31è¡Œï¼‰ï¼š**
```java
public final static String FILE_BASE_PATH = System.getProperty("user.dir") + "/files/";
```

- `System.getProperty("user.dir")` è·å–çš„æ˜¯é¡¹ç›®è¿è¡Œç›®å½•ï¼š`D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº`
- å®é™…ä¿å­˜è·¯å¾„ï¼š`D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\files\`

### 2. WebConfig.java é™æ€èµ„æºæ˜ å°„é…ç½®ï¼ˆç¬¬86è¡Œï¼‰

```java
registry.addResourceHandler("/files/**")
    .addResourceLocations("file:D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files/")
```

- è®¿é—®è·¯å¾„æ˜ å°„åˆ°ï¼š`D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files/`
- **è·¯å¾„ä¸åŒ¹é…ï¼**

### 3. application.yml é…ç½®æœªç”Ÿæ•ˆï¼ˆç¬¬87è¡Œï¼‰

```yaml
file:
  upload:
    path: D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files
```

- é…ç½®å­˜åœ¨ä½† FileUtil æ²¡æœ‰è¯»å–ä½¿ç”¨

## ä¿®å¤æ–¹æ¡ˆ

### âœ… ä¿®æ”¹ FileUtil.java

å°†ç¡¬ç¼–ç è·¯å¾„æ”¹ä¸ºä»é…ç½®æ–‡ä»¶è¯»å–ï¼š

```java
@Component
public class FileUtil {
    private final static Logger log = LoggerFactory.getLogger(FileUtil.class);
    
    // æ”¹ä¸ºå¯é…ç½®çš„é™æ€å˜é‡
    private static String FILE_BASE_PATH;
    private static final String ROOT_PATH = "/files/";
    
    // æ³¨å…¥é…ç½®å€¼
    @Value("${file.upload.path:./files}")
    private String uploadPath;
    
    private static FileUtil instance;
    
    // åˆå§‹åŒ–æ–¹æ³•
    @PostConstruct
    public void init() {
        instance = this;
        // ç¡®ä¿è·¯å¾„ä»¥åˆ†éš”ç¬¦ç»“å°¾
        String path = uploadPath.replace("\\", "/");
        if (!path.endsWith("/")) {
            path = path + "/";
        }
        FILE_BASE_PATH = path;
        log.info("æ–‡ä»¶ä¸Šä¼ åŸºç¡€è·¯å¾„å·²åˆå§‹åŒ–: {}", FILE_BASE_PATH);
    }
    
    // æä¾›è·å–æ–¹æ³•
    public static String getFileBasePath() {
        if (FILE_BASE_PATH == null && instance != null) {
            instance.init();
        }
        return FILE_BASE_PATH != null ? FILE_BASE_PATH : System.getProperty("user.dir") + "/files/";
    }
}
```

**å…³é”®ä¿®æ”¹ç‚¹ï¼š**
1. âœ… æ·»åŠ  `@Component` æ³¨è§£ï¼Œä½¿ FileUtil æˆä¸º Spring Bean
2. âœ… ä½¿ç”¨ `@Value` æ³¨è§£è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
3. âœ… ä½¿ç”¨ `@PostConstruct` åœ¨ Bean åˆå§‹åŒ–åè®¾ç½®è·¯å¾„
4. âœ… å°†æ‰€æœ‰ä½¿ç”¨ `FILE_BASE_PATH` çš„åœ°æ–¹æ”¹ä¸ºè°ƒç”¨ `getFileBasePath()`

### ğŸ“ é…ç½®ä¸€è‡´æ€§

ç°åœ¨ä¸‰å¤„é…ç½®ä¿æŒä¸€è‡´ï¼š

1. **application.yml**
```yaml
file:
  upload:
    path: D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files
```

2. **WebConfig.java**
```java
registry.addResourceHandler("/files/**")
    .addResourceLocations("file:D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files/")
```

3. **FileUtil.java**
```java
// ä»é…ç½®æ–‡ä»¶è¯»å–ï¼šD:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files
@Value("${file.upload.path:./files}")
private String uploadPath;
```

## éªŒè¯æ­¥éª¤

### 1. é‡å¯åç«¯æœåŠ¡

é‡å¯åæŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
æ–‡ä»¶ä¸Šä¼ åŸºç¡€è·¯å¾„å·²åˆå§‹åŒ–: D:/å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº/springboot/files/
```

### 2. ä¸Šä¼ æ–°å›¾ç‰‡

1. ç™»å½•ç®¡ç†åå°
2. è¿›å…¥è¯¾ç¨‹ç®¡ç†
3. ç¼–è¾‘è¯¾ç¨‹å¹¶ä¸Šä¼ å°é¢å›¾ç‰‡
4. æ£€æŸ¥æ–‡ä»¶ä¿å­˜ä½ç½®

**é¢„æœŸç»“æœï¼š**
- æ–‡ä»¶ä¿å­˜åœ¨ï¼š`D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\springboot\files\bussiness\course\`
- å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º

### 3. æ¸…ç†æ—§æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœ `D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\files\` ç›®å½•ä¸‹æœ‰æ—§æ–‡ä»¶ï¼Œå¯ä»¥ï¼š

**æ–¹æ¡ˆä¸€ï¼šç§»åŠ¨æ–‡ä»¶**
```powershell
# ç§»åŠ¨æ—§æ–‡ä»¶åˆ°æ–°ä½ç½®
Move-Item "D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\files\*" "D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\springboot\files\" -Force
```

**æ–¹æ¡ˆäºŒï¼šåˆ é™¤æ—§æ–‡ä»¶ï¼Œé‡æ–°ä¸Šä¼ **
```powershell
# åˆ é™¤æ—§æ–‡ä»¶
Remove-Item "D:\å¥èº«æˆ¿é¢„çº¦å°ç¨‹åº\files\*" -Recurse -Force
```

## åç»­ç»´æŠ¤å»ºè®®

### 1. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰

ä¿®æ”¹ `application.yml`ï¼š
```yaml
file:
  upload:
    path: ./files  # ç›¸å¯¹äºé¡¹ç›®è¿è¡Œç›®å½•
```

ä¿®æ”¹ `WebConfig.java`ï¼š
```java
registry.addResourceHandler("/files/**")
    .addResourceLocations("file:./files/")
```

**ä¼˜åŠ¿ï¼š**
- âœ… è·¨å¹³å°å…¼å®¹ï¼ˆWindows/Linux/Macï¼‰
- âœ… éƒ¨ç½²çµæ´»ï¼Œä¸å—ç»å¯¹è·¯å¾„é™åˆ¶
- âœ… å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒç»Ÿä¸€

### 2. é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†

å¯ä»¥è€ƒè™‘ä»æ•°æ®åº“é…ç½®è¡¨ `sys_config` è¯»å–æ–‡ä»¶è·¯å¾„ï¼š

```java
@Service
public class FileConfigService {
    @Resource
    private SysConfigService sysConfigService;
    
    public String getUploadPath() {
        return sysConfigService.getConfigValue("file.upload.path", "./files");
    }
}
```

### 3. è·¯å¾„éªŒè¯

å¯åŠ¨æ—¶éªŒè¯é…ç½®çš„è·¯å¾„æ˜¯å¦å¯è®¿é—®ï¼š

```java
@PostConstruct
public void validatePath() {
    File dir = new File(FILE_BASE_PATH);
    if (!dir.exists()) {
        log.warn("æ–‡ä»¶ä¸Šä¼ ç›®å½•ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º: {}", FILE_BASE_PATH);
        if (!dir.mkdirs()) {
            log.error("åˆ›å»ºæ–‡ä»¶ä¸Šä¼ ç›®å½•å¤±è´¥: {}", FILE_BASE_PATH);
        }
    }
}
```

## å¸¸è§é—®é¢˜

### Q1: é‡å¯åè¿˜æ˜¯ä¿å­˜åˆ°æ—§è·¯å¾„ï¼Ÿ

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ä»£ç å·²ç¼–è¯‘ï¼šåˆ é™¤ `target` ç›®å½•é‡æ–°æ„å»º
2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—æ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„è·¯å¾„
3. æ£€æŸ¥ `application.yml` é…ç½®æ˜¯å¦æ­£ç¡®

### Q2: å›¾ç‰‡è¿˜æ˜¯ä¸æ˜¾ç¤ºï¼Ÿ

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿å­˜åˆ°æ­£ç¡®ä½ç½®
2. æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8888/files/bussiness/course/xxx.jpg`
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ç½‘ç»œè¯·æ±‚
4. æ£€æŸ¥ WebConfig çš„é™æ€èµ„æºæ˜ å°„é…ç½®

### Q3: ç›¸å¯¹è·¯å¾„ `./files` æŒ‡å‘å“ªé‡Œï¼Ÿ

- å¯¹äº SpringBoot åº”ç”¨ï¼šé¡¹ç›®è¿è¡Œç›®å½•ï¼ˆé€šå¸¸æ˜¯é¡¹ç›®æ ¹ç›®å½•ï¼‰
- å¯¹äº WebConfig é™æ€èµ„æºæ˜ å°„ï¼šSpringBoot åº”ç”¨æ ¹ç›®å½•

**éªŒè¯æ–¹æ³•ï¼š**
```java
log.info("å½“å‰å·¥ä½œç›®å½•: {}", System.getProperty("user.dir"));
```

## æ€»ç»“

æœ¬æ¬¡ä¿®å¤è§£å†³äº†æ–‡ä»¶ä¸Šä¼ è·¯å¾„é…ç½®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ ¸å¿ƒæ”¹è¿›ï¼š

1. âœ… FileUtil ä»é…ç½®æ–‡ä»¶è¯»å–è·¯å¾„ï¼Œä¸å†ç¡¬ç¼–ç 
2. âœ… ç¡®ä¿ application.ymlã€WebConfigã€FileUtil ä¸‰å¤„é…ç½®ä¸€è‡´
3. âœ… æ·»åŠ æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
4. âœ… æä¾›è·¯å¾„è·å–æ–¹æ³•ï¼Œç»Ÿä¸€ç®¡ç†

**å½±å“èŒƒå›´ï¼š**
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- å›¾ç‰‡è®¿é—®åŠŸèƒ½
- æ–‡ä»¶åˆ é™¤åŠŸèƒ½
