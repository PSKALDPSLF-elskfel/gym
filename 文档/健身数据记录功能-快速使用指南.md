# 健身数据记录功能 - 快速使用指南

## 📋 功能概述

健身数据记录模块为用户提供完整的运动数据管理功能，包括：
- ✅ 运动记录的增删改查
- ✅ 支持有氧运动和力量训练
- ✅ 自动统计运动数据
- ✅ 运动成就系统（预留）
- ✅ 连续运动天数计算
- ✅ 每日/周/月数据统计

---

## 🚀 快速开始

### 1. 数据库初始化

```bash
# 执行SQL脚本初始化数据库
mysql -u root -p gym_booking_system < database/workout_record_system.sql
```

**说明**：
- 会创建6张表：运动类型表、运动记录表、运动详情表、每日统计表、成就表、用户成就表
- 自动插入10种常见运动类型（跑步、深蹲、游泳等）
- 创建数据库触发器，自动维护每日统计
- 创建存储过程，计算连续运动天数

---

### 2. 后端代码结构

```
springboot/src/main/java/org/example/springboot/
├── enums/                    # 枚举类
│   ├── WorkoutCategory.java       # 运动分类枚举
│   ├── WorkoutIntensity.java      # 运动强度枚举
│   ├── WorkoutFeeling.java        # 运动感受枚举
│   ├── WorkoutSource.java         # 数据来源枚举
│   └── AchievementType.java       # 成就类型枚举
├── entity/                   # 实体类
│   ├── GymWorkoutType.java        # 运动类型实体
│   ├── GymWorkoutRecord.java      # 运动记录实体
│   ├── GymWorkoutDetail.java      # 运动详情实体
│   ├── GymWorkoutDailyStats.java  # 每日统计实体
│   ├── GymWorkoutAchievement.java # 成就实体
│   └── GymUserAchievement.java    # 用户成就实体
├── mapper/                   # 数据访问层
│   ├── GymWorkoutTypeMapper.java
│   ├── GymWorkoutRecordMapper.java
│   ├── GymWorkoutDetailMapper.java
│   ├── GymWorkoutDailyStatsMapper.java
│   ├── GymWorkoutAchievementMapper.java
│   └── GymUserAchievementMapper.java
├── dto/command/             # 请求DTO
│   ├── WorkoutRecordCreateDTO.java
│   ├── WorkoutRecordUpdateDTO.java
│   └── WorkoutDetailDTO.java
├── dto/response/            # 响应DTO
│   ├── WorkoutRecordResponseDTO.java
│   ├── WorkoutDetailResponseDTO.java
│   ├── WorkoutTypeResponseDTO.java
│   ├── WorkoutDailyStatsResponseDTO.java
│   └── WorkoutStatisticsSummaryDTO.java
├── service/                 # 业务逻辑层
│   └── WorkoutRecordService.java
└── controller/              # 控制器层
    └── WorkoutRecordController.java
```

---

## 💡 核心功能使用

### 功能1: 记录有氧运动（如跑步）

**场景**: 用户完成30分钟跑步，距离5公里

**API调用**:
```bash
POST /workout/record
Authorization: Bearer {token}

{
  "workoutTypeId": 1,           # 跑步类型ID
  "workoutDate": "2025-12-12",
  "startTime": "2025-12-12 07:00:00",
  "endTime": "2025-12-12 07:30:00",
  "duration": 30,               # 30分钟
  "intensity": "MEDIUM",        # 中等强度
  "calories": 250,              # 消耗250千卡
  "distance": 5.0,              # 5公里
  "steps": 6500,                # 6500步
  "heartRateAvg": 145,          # 平均心率145
  "heartRateMax": 165,          # 最大心率165
  "note": "早晨跑步，感觉不错",
  "feeling": "GOOD",            # 感觉良好
  "weather": "晴天",
  "location": "健身房跑步机",
  "isCompleted": 1,
  "source": "MANUAL"
}
```

**自动触发**:
- ✅ 自动更新当日统计数据
- ✅ 自动计算热量消耗
- ✅ 记录运动轨迹

---

### 功能2: 记录力量训练（如深蹲）

**场景**: 用户完成深蹲训练，包含多组动作

**API调用**:
```bash
POST /workout/record
Authorization: Bearer {token}

{
  "workoutTypeId": 7,           # 深蹲类型ID
  "workoutDate": "2025-12-12",
  "startTime": "2025-12-12 18:00:00",
  "endTime": "2025-12-12 18:45:00",
  "duration": 45,
  "intensity": "HIGH",
  "calories": 180,
  "note": "腿部训练日",
  "feeling": "TIRED",
  "location": "健身房",
  "isCompleted": 1,
  "source": "MANUAL",
  "details": [                  # 力量训练详情
    {
      "actionName": "杠铃深蹲",
      "sets": 4,                # 计划4组
      "reps": 12,               # 每组12次
      "weight": 80.5,           # 重量80.5kg
      "restTime": 90,           # 组间休息90秒
      "actualSets": 4,          # 实际完成4组
      "actualReps": 10,         # 实际每组10次
      "note": "感觉良好"
    },
    {
      "actionName": "腿举",
      "sets": 3,
      "reps": 15,
      "weight": 120.0,
      "restTime": 60,
      "actualSets": 3,
      "actualReps": 15
    }
  ]
}
```

---

### 功能3: 查询运动统计

**场景**: 查看本月运动数据汇总

**API调用**:
```bash
GET /workout/statistics/summary
Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "totalWorkouts": 25,          # 总运动次数
  "totalDuration": 1500,        # 总时长1500分钟
  "totalCalories": 5800,        # 总消耗5800千卡
  "totalDistance": 75.5,        # 总距离75.5公里
  "avgDuration": 60,            # 平均时长60分钟
  "workoutDays": 20,            # 运动天数20天
  "streakDays": 7,              # 连续运动7天
  "weekWorkouts": 5,            # 本周5次
  "monthWorkouts": 18,          # 本月18次
  "cardioPercentage": 65.50,    # 有氧占比65.5%
  "strengthPercentage": 34.50   # 力量占比34.5%
}
```

---

### 功能4: 查询每日统计

**场景**: 查看最近7天的运动数据

**API调用**:
```bash
GET /workout/statistics/daily?startDate=2025-12-05&endDate=2025-12-12
Authorization: Bearer {token}
```

**应用场景**:
- 📊 生成运动曲线图
- 📈 分析运动趋势
- 🎯 查看目标完成情况

---

### 功能5: 查询运动类型

**场景**: 获取所有有氧运动类型

**API调用**:
```bash
GET /workout/type/list?category=CARDIO
```

**响应**:
```json
[
  {
    "id": 1,
    "name": "跑步",
    "category": "CARDIO",
    "metValue": 8.00,
    "description": "有氧运动，提升心肺功能"
  },
  {
    "id": 2,
    "name": "快走",
    "category": "CARDIO",
    "metValue": 3.50,
    "description": "低强度有氧运动"
  }
]
```

---

## 📊 数据自动统计说明

### 触发器机制

系统使用MySQL触发器自动维护每日统计数据：

**触发时机**:
- ✅ 创建运动记录时 → 增加统计
- ✅ 更新运动记录时 → 调整统计
- ✅ 删除运动记录时 → 减少统计

**统计字段**:
```sql
- total_duration       # 总时长
- total_calories       # 总热量
- total_distance       # 总距离
- total_steps          # 总步数
- workout_count        # 运动次数
- cardio_duration      # 有氧时长
- strength_duration    # 力量时长
- flexibility_duration # 柔韧性时长
```

---

## 🎯 使用建议

### 1. 记录粒度建议

**推荐做法**:
- ✅ 有氧运动：记录核心数据（时长、距离、心率）
- ✅ 力量训练：详细记录每个动作的组数、次数、重量
- ✅ 柔韧性训练：记录时长和感受

**避免**:
- ❌ 过于复杂的记录导致用户负担
- ❌ 缺少关键数据影响统计准确性

---

### 2. 数据完整性

**必填字段**:
- 运动类型ID
- 运动日期
- 开始时间
- 运动时长

**建议填写**:
- 消耗热量（可自动计算）
- 运动强度
- 运动感受
- 备注信息

---

### 3. 统计数据应用

**实时统计**:
```bash
# 查看今日数据
GET /workout/statistics/daily?startDate=2025-12-12&endDate=2025-12-12

# 查看本周数据  
GET /workout/statistics/daily?startDate=2025-12-08&endDate=2025-12-12

# 查看本月数据
GET /workout/statistics/daily?startDate=2025-12-01&endDate=2025-12-31
```

**汇总统计**:
```bash
# 个人运动数据总览
GET /workout/statistics/summary
```

---

## ⚙️ 配置说明

### 1. 运动类型配置

在数据库中可以添加自定义运动类型：

```sql
INSERT INTO gym_workout_type (name, category, met_value, description, sort_order, status)
VALUES ('HIIT训练', 'CARDIO', 10.00, '高强度间歇训练', 20, 1);
```

### 2. MET值说明

**MET (代谢当量)** 用于计算热量消耗：

```
消耗热量(kcal) = MET值 × 体重(kg) × 运动时长(小时)
```

**常见MET值**:
- 快走: 3.5
- 跑步: 8.0
- 游泳: 7.0
- 骑行: 6.0
- 力量训练: 4.0-6.0

---

## 🔧 故障排查

### 问题1: 统计数据不准确

**排查步骤**:
1. 检查触发器是否正常
```sql
SHOW TRIGGERS LIKE 'gym_workout_record';
```

2. 手动刷新统计数据
```sql
-- 删除旧统计
DELETE FROM gym_workout_daily_stats WHERE user_id = ? AND stat_date = ?;

-- 重新生成
-- 由触发器自动生成
```

---

### 问题2: 连续运动天数计算错误

**原因**: 可能是运动日期设置不正确

**解决**:
```sql
-- 查看用户运动日期
SELECT DISTINCT workout_date 
FROM gym_workout_record 
WHERE user_id = ? 
ORDER BY workout_date DESC;
```

---

## 📝 下一步开发计划

### 1. 成就系统激活（P2优先级）
- [ ] 激活成就判定逻辑
- [ ] 用户成就获取
- [ ] 成就通知推送

### 2. 小程序端开发（P2优先级）
- [ ] 运动记录录入页面
- [ ] 运动数据统计页面
- [ ] 运动历史查询页面
- [ ] 数据可视化图表

### 3. 数据导出（P3优先级）
- [ ] 运动数据导出Excel
- [ ] 生成运动报告
- [ ] 数据对比分析

---

## 📞 技术支持

如有问题，请参考：
1. API测试文档: `API测试文档-健身数据记录.md`
2. 数据库设计: `database/workout_record_system.sql`
3. 代码注释和日志

---

**文档版本**: v1.0  
**最后更新**: 2025-12-12  
**维护者**: System
