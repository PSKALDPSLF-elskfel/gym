# 教练端课程签到功能 - 测试指南

## 📚 功能概述

教练端课程签到功能允许教练查看课程预约情况，并为学员进行签到操作。

## 🎯 功能特性

1. **签到管理页面** - 完整的学员签到界面
2. **实时统计** - 总预约人数、已签到、未签到、签到率
3. **搜索筛选** - 按学员姓名/手机号搜索，按签到状态筛选
4. **签到操作** - 一键为学员签到
5. **防重复签到** - 已签到的学员不能重复签到

## 🚀 快速开始

### 1. 启动后端服务

```bash
cd D:\健身房预约小程序\springboot
mvn spring-boot:run
```

### 2. 启动教练端前端

```bash
cd D:\健身房预约小程序\vue3\coach
npm install  # 首次运行需要安装依赖
npm run dev
```

访问地址: http://localhost:5173

### 3. 登录教练账号

使用教练账号登录系统（确保用户类型为COACH）

---

## 📋 测试步骤

### 步骤1: 访问课程列表

1. 登录后点击左侧菜单 "课程管理"
2. 查看我的课程列表
3. 可以按日期筛选课程

### 步骤2: 进入课程详情

1. 点击课程列表中的 "详情" 按钮
2. 查看课程基本信息
3. 查看预约学员列表
4. 查看课程统计数据（包含签到统计）

### 步骤3: 进入签到管理

**方法1**: 从课程详情页
- 点击右上角的 "签到管理" 按钮

**方法2**: 从课程列表页
- 点击 "签到管理" 按钮（如果有）

### 步骤4: 查看签到页面

签到管理页面包含:

1. **页面标题**: 显示课程名称、日期、时间
2. **统计卡片**: 
   - 总预约人数（绿色）
   - 已签到（蓝色）
   - 未签到（红色）
   - 签到率（百分比）

3. **学员列表**:
   - 学员头像和信息（姓名、手机号）
   - 预约时间
   - 签到状态（已签到/未签到）
   - 签到时间
   - 备注
   - 操作按钮

### 步骤5: 使用搜索和筛选

**搜索功能**:
1. 在搜索框输入学员姓名或手机号
2. 点击搜索或按回车
3. 列表自动过滤显示匹配的学员

**状态筛选**:
1. 点击"全部"/"已签到"/"未签到"单选按钮
2. 列表自动按状态筛选

### 步骤6: 为学员签到

1. 找到未签到的学员
2. 点击该学员行的"签到"按钮
3. 在弹出的确认框中点击"确定"
4. 系统显示"签到成功"提示
5. 列表自动刷新，签到状态更新
6. 统计数据自动更新

---

## ✅ 验证点

### 界面显示

- [ ] 页面标题正确显示课程信息
- [ ] 统计卡片显示正确的数值
- [ ] 学员列表正确显示所有预约学员
- [ ] 学员头像、姓名、手机号正确显示
- [ ] 签到状态标签正确显示（已签到显示绿色，未签到显示灰色）
- [ ] 签到时间正确显示（已签到的学员）

### 搜索功能

- [ ] 按姓名搜索正常工作
- [ ] 按手机号搜索正常工作
- [ ] 搜索结果正确
- [ ] 搜索后可以清除继续显示所有学员

### 筛选功能

- [ ] "全部"筛选显示所有学员
- [ ] "已签到"筛选只显示已签到的学员
- [ ] "未签到"筛选只显示未签到的学员
- [ ] 筛选切换正常

### 签到操作

- [ ] 点击"签到"按钮弹出确认框
- [ ] 确认框显示正确的学员姓名
- [ ] 点击"确定"后签到成功
- [ ] 签到成功后显示成功提示
- [ ] 签到成功后列表自动刷新
- [ ] 签到成功后统计数据更新
- [ ] 已签到的学员显示"已签到"标签，不显示"签到"按钮
- [ ] 重复签到时后端返回错误提示

### 数据准确性

- [ ] 统计数据计算正确
- [ ] 签到率计算正确（已签到数/总预约数 * 100）
- [ ] 签到时间格式正确（YYYY-MM-DD HH:mm）
- [ ] 签到后数据库正确保存签到记录

---

## 🧪 测试用例

### 用例1: 正常签到流程

**前置条件**:
- 存在一个有预约学员的课程
- 至少有一个未签到的学员

**操作步骤**:
1. 进入课程签到管理页面
2. 点击某个未签到学员的"签到"按钮
3. 在确认框中点击"确定"

**预期结果**:
- 显示"签到成功"提示
- 该学员的签到状态变为"已签到"
- 显示签到时间
- 统计数据更新（已签到+1，未签到-1）
- 签到率重新计算

---

### 用例2: 重复签到

**前置条件**:
- 学员已经签到

**操作步骤**:
1. 尝试点击已签到学员的操作按钮

**预期结果**:
- 已签到学员显示"已签到"标签，无"签到"按钮
- 无法重复签到

---

### 用例3: 搜索学员

**前置条件**:
- 课程有多个预约学员

**操作步骤**:
1. 在搜索框输入学员姓名的一部分
2. 点击搜索

**预期结果**:
- 列表只显示匹配的学员
- 统计数据不变（显示所有学员的统计）

---

### 用例4: 状态筛选

**前置条件**:
- 课程有已签到和未签到的学员

**操作步骤**:
1. 点击"已签到"筛选
2. 点击"未签到"筛选
3. 点击"全部"筛选

**预期结果**:
- "已签到": 只显示已签到的学员
- "未签到": 只显示未签到的学员
- "全部": 显示所有学员

---

### 用例5: 全部签到完成

**前置条件**:
- 课程有多个预约学员

**操作步骤**:
1. 为所有学员完成签到

**预期结果**:
- 未签到人数 = 0
- 签到率 = 100%
- 所有学员都显示"已签到"标签

---

## 🐛 常见问题

### Q1: 点击签到按钮没有反应

**可能原因**:
- 后端服务未启动
- 网络请求失败
- 预约ID不正确

**解决方法**:
1. 检查后端服务是否正常运行
2. 打开浏览器控制台查看网络请求
3. 检查请求参数是否正确

---

### Q2: 签到成功但列表未更新

**可能原因**:
- 列表刷新失败

**解决方法**:
1. 手动刷新页面
2. 检查获取预约列表的接口是否正常

---

### Q3: 统计数据不准确

**可能原因**:
- 计算逻辑错误
- 数据未及时刷新

**解决方法**:
1. 检查前端计算逻辑
2. 确保签到后重新获取数据
3. 检查后端返回的签到信息

---

### Q4: 签到时间显示为空

**可能原因**:
- 后端未返回签到时间
- 签到记录未关联到预约

**解决方法**:
1. 检查后端CourseBookingDetailDTO是否包含checkInTime字段
2. 检查后端是否正确关联签到记录
3. 检查数据库gym_course_sign_in表是否有对应记录

---

## 📊 数据库验证

签到成功后，可以在数据库中验证：

```sql
-- 查询签到记录
SELECT * FROM gym_course_sign_in 
WHERE booking_id = ? 
ORDER BY create_time DESC;

-- 查询课程的所有签到记录
SELECT 
  gcs.*,
  u.nickname,
  gcb.create_time as booking_time
FROM gym_course_sign_in gcs
LEFT JOIN gym_course_booking gcb ON gcs.booking_id = gcb.id
LEFT JOIN user u ON gcs.user_id = u.id
WHERE gcs.schedule_id = ?
ORDER BY gcs.sign_in_time DESC;
```

---

## 🎨 UI截图说明

### 签到管理页面

**顶部统计卡片**:
- 4个卡片横向排列
- 显示图标和数值
- 不同颜色区分

**学员列表**:
- 表格形式展示
- 包含搜索框和筛选按钮
- 显示学员头像（圆形）
- 签到状态用标签显示
- 操作按钮在最右侧

---

## 🔗 相关接口

### 后端接口

1. **获取课程详情**
   - GET `/course-schedule/{scheduleId}`

2. **获取预约列表**
   - GET `/booking/schedule/{scheduleId}`

3. **学员签到**
   - POST `/course-schedule/{scheduleId}/sign-in`
   - 请求体: `{ "bookingId": 1 }`

---

## 📝 开发说明

### 前端文件

- **签到页面**: `vue3/coach/src/views/courses/Attendance.vue`
- **API接口**: `vue3/coach/src/api/course.js`
- **路由配置**: `vue3/coach/src/router/index.js`

### 后端文件

- **签到Controller**: `CourseScheduleController.java`
- **签到Service**: `CourseSignInService.java`
- **签到实体**: `GymCourseSignIn.java`

---

## ✅ 测试清单

- [ ] 后端服务正常启动
- [ ] 前端服务正常启动
- [ ] 教练账号可以正常登录
- [ ] 课程列表可以正常显示
- [ ] 课程详情可以正常显示
- [ ] 签到管理页面可以正常访问
- [ ] 统计卡片数据正确
- [ ] 学员列表正确显示
- [ ] 搜索功能正常
- [ ] 筛选功能正常
- [ ] 签到操作成功
- [ ] 签到后数据自动刷新
- [ ] 已签到学员不能重复签到
- [ ] 签到记录保存到数据库

---

**最后更新**: 2025-12-12  
**测试版本**: v1.0  
**测试人员**: 开发团队
